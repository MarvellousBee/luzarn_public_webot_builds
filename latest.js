(function(_0x332918,_0x5ac870){const _0x37246b=a0_0x5e63,_0x3f0bcd=_0x332918();while(!![]){try{const _0x5851bd=parseInt(_0x37246b(0x1e1))/0x1*(parseInt(_0x37246b(0x1eb))/0x2)+-parseInt(_0x37246b(0x1e0))/0x3+parseInt(_0x37246b(0x1ca))/0x4*(-parseInt(_0x37246b(0x1c5))/0x5)+-parseInt(_0x37246b(0x15f))/0x6+-parseInt(_0x37246b(0x168))/0x7*(parseInt(_0x37246b(0x1d2))/0x8)+parseInt(_0x37246b(0x1a8))/0x9+-parseInt(_0x37246b(0x17f))/0xa*(-parseInt(_0x37246b(0x155))/0xb);if(_0x5851bd===_0x5ac870)break;else _0x3f0bcd['push'](_0x3f0bcd['shift']());}catch(_0xf1f3be){_0x3f0bcd['push'](_0x3f0bcd['shift']());}}}(a0_0xa088,0x3f131),(function(){const _0x17f715=a0_0x5e63;let OVERRIDABLE={user_tag(){return'anonymous';}};const _0x51e51e=!!(HTMLElement[_0x17f715(0x1ac)]&&HTMLElement[_0x17f715(0x1ac)][_0x17f715(0x1de)]);let _0x552a23=null,_0x2e4120=null;if(_0x51e51e)try{_0x552a23=document[_0x17f715(0x16e)](_0x17f715(0x14e));!_0x552a23&&(_0x552a23=document[_0x17f715(0x1d3)]('div'),_0x552a23['id']=_0x17f715(0x14e),_0x552a23['style'][_0x17f715(0x186)]=_0x17f715(0x17c),_0x552a23[_0x17f715(0x162)][_0x17f715(0x161)]='fixed',_0x552a23['style'][_0x17f715(0x153)]=_0x17f715(0x172),_0x552a23[_0x17f715(0x162)][_0x17f715(0x1f8)]=_0x17f715(0x207),_0x552a23[_0x17f715(0x162)][_0x17f715(0x1fb)]=_0x17f715(0x207),_0x552a23[_0x17f715(0x162)][_0x17f715(0x16b)]=_0x17f715(0x15a),document['body'][_0x17f715(0x166)](_0x552a23));!_0x552a23['shadowRoot']?_0x2e4120=_0x552a23[_0x17f715(0x1de)]({'mode':_0x17f715(0x1e8)}):_0x2e4120=_0x552a23[_0x17f715(0x182)];const _0x688d06=document[_0x17f715(0x1d3)]('style');_0x688d06['textContent']=_0x17f715(0x1c7),_0x2e4120[_0x17f715(0x166)](_0x688d06);const _0x4624ee=_0x17f715(0x165);function _0x537bba(_0x53fcdd){const _0xad173b=_0x17f715;if(!_0x2e4120)return;const _0x267251=_0x2e4120[_0xad173b(0x193)](_0xad173b(0x1cc)),_0x52fd48=_0x53fcdd||_0x4624ee;if(_0x267251){_0x267251[_0xad173b(0x1b8)](_0xad173b(0x1f1))!==_0x52fd48&&_0x267251[_0xad173b(0x1f5)](_0xad173b(0x1f1),_0x52fd48);return;}let _0x29437f=document[_0xad173b(0x193)]('link[rel=\x22stylesheet\x22][href*=\x22luzarn_public_webot_builds\x22][href$=\x22latest.css\x22]'),_0x14c0ed;if(_0x29437f){_0x14c0ed=_0x29437f[_0xad173b(0x1ad)](!![]);if(_0x53fcdd)_0x14c0ed[_0xad173b(0x1f1)]=_0x52fd48;}else _0x14c0ed=document[_0xad173b(0x1d3)](_0xad173b(0x1cf)),_0x14c0ed[_0xad173b(0x15c)]=_0xad173b(0x1b0),_0x14c0ed[_0xad173b(0x1f1)]=_0x52fd48;_0x14c0ed[_0xad173b(0x1f5)](_0xad173b(0x17e),'1');try{_0x2e4120[_0xad173b(0x166)](_0x14c0ed);}catch(_0x45776f){}}window[_0x17f715(0x1b6)]=_0x537bba;try{const _0x552211=new MutationObserver(_0x216e21=>{const _0x5d65b4=_0x17f715;for(const _0x11e5b4 of _0x216e21){for(const _0x540d3a of _0x11e5b4[_0x5d65b4(0x1bf)]){if(_0x540d3a[_0x5d65b4(0x16c)]===_0x5d65b4(0x160)&&/luzarn_public_webot_builds/[_0x5d65b4(0x164)](_0x540d3a[_0x5d65b4(0x1b8)](_0x5d65b4(0x1f1))||'')){_0x537bba(),_0x552211[_0x5d65b4(0x1c4)]();return;}}}});if(document[_0x17f715(0x185)])_0x552211[_0x17f715(0x187)](document['head'],{'childList':!![],'subtree':![]});setTimeout(()=>{const _0x4e6779=_0x17f715;try{_0x552211[_0x4e6779(0x1c4)]();}catch(_0x5e787c){}},0x1388);}catch(_0xeed6a8){}}catch(_0xeb87d3){_0x2e4120=null,_0x552a23=null;}const _0x483745=()=>_0x2e4120||document[_0x17f715(0x1ab)];function _0x487b6a(_0x39d1da){const _0x40d9d7=_0x17f715;if(_0x2e4120)return _0x2e4120[_0x40d9d7(0x193)](_0x39d1da);return document['querySelector'](_0x39d1da);}function _0x4c0b49(_0x3862ff){const _0x5ce7c6=_0x17f715;if(_0x2e4120)return _0x2e4120[_0x5ce7c6(0x1b4)](_0x3862ff);return document['querySelectorAll'](_0x3862ff);}function _0x65497e(_0x4ca4ab){const _0x70fcd8=_0x17f715;if(_0x2e4120)return _0x2e4120[_0x70fcd8(0x193)]('#'+CSS['escape'](_0x4ca4ab));return document[_0x70fcd8(0x16e)](_0x4ca4ab);}const _0x2da641=_0x17f715(0x1df),_0xb98737=_0x17f715(0x203),_0x34dbf7='.'+_0xb98737,_0x2e2379='http://',_0x2fd5da=_0x17f715(0x1fe),_0x19c2e1=_0x17f715(0x20a),_0x1804db=_0x17f715(0x201),_0x2fc729=LUZARN_BOT_DEFINITIONS['USE_LOCAL_DEPLOYMENT']===!![],_0x56e6e2=_0x2fc729?_0x2da641:_0xb98737,_0x5e3503=_0x2fc729?_0x2e2379:_0x2fd5da,_0x25914f=_0x2fc729?_0x19c2e1:_0x1804db,_0x449a5d=LUZARN_BOT_DEFINITIONS[_0x17f715(0x17b)]||null,_0x1e9c03=LUZARN_BOT_DEFINITIONS[_0x17f715(0x197)]||null;!_0x1e9c03&&console[_0x17f715(0x176)](_0x17f715(0x14d));_0x449a5d&&console['log']('DEVMODE_TOKEN\x20detected\x20-\x20using\x20dev\x20website\x20version');try{const _0x381ce8=['localhost','0.0.0.0',_0x17f715(0x14b)]['includes'](location[_0x17f715(0x19c)])||/^127\./[_0x17f715(0x164)](location[_0x17f715(0x19c)]),_0x69c72e=_0x17f715(0x18a),_0x2c4dc1=_0x2fc729||_0x381ce8?_0x69c72e:_0x17f715(0x165);window[_0x17f715(0x1b6)]&&window['__luzarn_deferred_style_injection'](_0x2c4dc1);}catch(_0x3e5578){}console[_0x17f715(0x1d4)](_0x17f715(0x178)+(_0x2fc729?_0x17f715(0x1b5):'production')+_0x17f715(0x1f9)+_0x56e6e2),console['log'](_0x17f715(0x1f2),{'HTTP_PROTOCOL':_0x5e3503,'WS_PROTOCOL':_0x25914f});const _0x249085={'consult_knowledge_base':_0x17f715(0x1da),'list_redirect_urls':'Browsing\x20the\x20website...','get_info_from_html':_0x17f715(0x1e5),'redirect':_0x17f715(0x204),'Intermediate_Answer':_0x17f715(0x1a5)};if(typeof LUZARN_BOT_DEFINITIONS===_0x17f715(0x1ef)&&LUZARN_BOT_DEFINITIONS!==null&&LUZARN_BOT_DEFINITIONS[_0x17f715(0x1b7)])for(const _0x471b9d in OVERRIDABLE){if(LUZARN_BOT_DEFINITIONS['OVERRIDES'][_0x471b9d]){if(typeof LUZARN_BOT_DEFINITIONS[_0x17f715(0x1b7)][_0x471b9d]==='function')OVERRIDABLE[_0x471b9d]=LUZARN_BOT_DEFINITIONS[_0x17f715(0x1b7)][_0x471b9d];else throw new Error(_0x17f715(0x1e2)+_0x471b9d+'\x20must\x20be\x20a\x20function');console['log'](_0x17f715(0x1a3)+_0x471b9d);}}else console[_0x17f715(0x19d)](_0x17f715(0x1fd));const _0x518825=OVERRIDABLE[_0x17f715(0x151)](),_0x464300='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20height=\x2218px\x22\x20viewBox=\x220\x20-960\x20960\x20960\x22\x20width=\x2218px\x22\x20fill=\x22#e5e5e5e6\x22><path\x20d=\x22M720-120H280v-520l280-280\x2050\x2050q7\x207\x2011.5\x2019t4.5\x2023v14l-44\x20174h258q32\x200\x2056\x2024t24\x2056v80q0\x207-2\x2015t-4\x2015L794-168q-9\x2020-30\x2034t-44\x2014Zm-360-80h360l120-280v-80H480l54-220-174\x20174v406Zm0-406v406-406Zm-80-34v80H160v360h120v80H80v-520h200Z\x22/></svg>',_0x592c22=_0x17f715(0x1a4),_0x17d951=_0x17f715(0x198),_0x4cb03e=_0x17f715(0x1ba);function _0xf95740(_0xe571aa){return new Promise(_0x5b4784=>setTimeout(_0x5b4784,_0xe571aa));}function _0x4d6f4c(){const _0x2baaec=_0x17f715,_0x57e560=window[_0x2baaec(0x1e6)][_0x2baaec(0x1ed)];return _0x3c40c5(_0x57e560);}function _0x3c40c5(_0x4f736b){const _0x24f992=_0x17f715,_0xab4a86=_0x4f736b[_0x24f992(0x20e)](_0x2da641);_0xab4a86!==-0x1&&(_0x4f736b=_0x4f736b[_0x24f992(0x16a)](_0xab4a86+_0x2da641[_0x24f992(0x17d)]));const _0x352608=_0x4f736b[_0x24f992(0x20e)]('/');return _0x352608!==-0x1?_0x4f736b=_0x4f736b[_0x24f992(0x16a)](_0x352608):_0x4f736b='/'+_0x4f736b,_0x4f736b;}function _0x1ff463(_0x28da2e){return encodeURIComponent(JSON['stringify'](_0x28da2e));}function _0x366ab7(_0x46b65d){try{return JSON['parse'](decodeURIComponent(_0x46b65d));}catch(_0x3f3f40){return null;}}function _0x4f1110(_0x28031a){return _0x28031a+'__'+(location['hostname']||'');}function _0x278968(_0x38115d){const _0x481a55=_0x17f715,_0x3168d4=_0x4f1110(_0x38115d),_0x1af1f7=document[_0x481a55(0x1c2)][_0x481a55(0x156)](';\x20')['reduce']((_0xcb44ec,_0xee89db)=>{const _0x58f0cb=_0x481a55,_0x38b3c8=_0xee89db['indexOf']('=');if(_0x38b3c8===-0x1)return _0xcb44ec;const _0x19a856=_0xee89db[_0x58f0cb(0x16a)](0x0,_0x38b3c8),_0x51585f=_0xee89db[_0x58f0cb(0x16a)](_0x38b3c8+0x1);return _0xcb44ec[_0x19a856]=_0x51585f,_0xcb44ec;},{});if(_0x1af1f7[_0x3168d4])return _0x366ab7(_0x1af1f7[_0x3168d4]);return null;}function _0x1ee3d1(_0x4e85c3,_0x125c9e,_0xe391aa,_0xe2d758=!![]){const _0x1e8ca5=_0x17f715;if(!_0xe2d758){const _0x4d3906=_0x278968(_0x1e8ca5(0x14c));if(!_0x4d3906)return;}const _0x2226e3=_0x1ff463(_0x125c9e),_0x27fa0c=[];_0x27fa0c[_0x1e8ca5(0x16f)](_0x4f1110(_0x4e85c3)+'='+_0x2226e3);if(_0xe391aa)_0x27fa0c[_0x1e8ca5(0x16f)]('Max-Age='+_0xe391aa*0x18*0x3c*0x3c);_0x27fa0c[_0x1e8ca5(0x16f)]('Path=/');try{const _0x32ec4e=(location[_0x1e8ca5(0x19c)]||'')[_0x1e8ca5(0x200)](),_0x2fc152=_0x32ec4e==='localhost'||_0x32ec4e==='::1'||_0x32ec4e===_0x1e8ca5(0x1ff)||/^127\./['test'](_0x32ec4e);if(!_0x2fc152&&_0x34dbf7){let _0x3a7345=String(_0x34dbf7)[_0x1e8ca5(0x200)]();_0x3a7345[_0x1e8ca5(0x1e3)]('.')&&(_0x3a7345=_0x3a7345[_0x1e8ca5(0x16a)](0x1));const _0x2b60ba=_0x32ec4e===_0x3a7345||_0x32ec4e[_0x1e8ca5(0x1ea)]('.'+_0x3a7345);_0x2b60ba&&_0x27fa0c['push'](_0x1e8ca5(0x152)+_0x3a7345);}}catch(_0x215142){}_0x27fa0c[_0x1e8ca5(0x16f)](_0x1e8ca5(0x1f4));const _0x375190=_0x27fa0c[_0x1e8ca5(0x1fa)](';');document['cookie']=_0x375190;}function _0x4589ab(_0x1b235a){const _0x299f94=_0x17f715,_0x5adbce=[];_0x5adbce['push'](_0x4f1110(_0x1b235a)+'='),_0x5adbce[_0x299f94(0x16f)](_0x299f94(0x205)),_0x5adbce[_0x299f94(0x16f)](_0x299f94(0x15d));try{const _0x57984d=(location['hostname']||'')['toLowerCase'](),_0x1f6546=_0x57984d===_0x299f94(0x19e)||_0x57984d===_0x299f94(0x14b)||_0x57984d===_0x299f94(0x1ff)||/^127\./[_0x299f94(0x164)](_0x57984d);if(!_0x1f6546&&_0x34dbf7){let _0x42d6dc=String(_0x34dbf7)[_0x299f94(0x200)]();if(_0x42d6dc[_0x299f94(0x1e3)]('.'))_0x42d6dc=_0x42d6dc['slice'](0x1);const _0x2e1a3b=_0x57984d===_0x42d6dc||_0x57984d['endsWith']('.'+_0x42d6dc);_0x2e1a3b&&_0x5adbce[_0x299f94(0x16f)](_0x299f94(0x152)+_0x42d6dc);}}catch(_0x1c1633){}_0x5adbce[_0x299f94(0x16f)]('SameSite=Lax'),document[_0x299f94(0x1c2)]=_0x5adbce[_0x299f94(0x1fa)](';');}function _0x280339(_0x92994d,_0x5c83de){const _0x4c4e4b=_0x17f715;_0x1ee3d1(_0x4c4e4b(0x1d8),{'url':_0x92994d,'reply_channel':_0x5c83de},0x1);}function _0x2eaf5c(){const _0x15440a=_0x17f715,_0x35d5fc=_0x278968(_0x15440a(0x1d8));if(_0x35d5fc)return _0x4589ab(_0x15440a(0x1d8)),_0x35d5fc;return null;}let _0x88383f=null;function _0x595058(_0x30d493){const _0x37a54e=_0x17f715;if(!_0x30d493)return _0x37a54e(0x163);try{return _0x88383f=_0x30d493,_0x37a54e(0x18f);}catch(_0x3debcb){return _0x37a54e(0x1bd)+_0x3debcb[_0x37a54e(0x180)];}}function _0x5c8548(){const _0x4f26f8=_0x17f715,_0x266155=_0x88383f;if(!_0x266155)return;_0x88383f=null;try{try{const _0x52dd3e=_0x65497e('chatbot-highlight-overlay');if(_0x52dd3e)_0x52dd3e[_0x4f26f8(0x159)]();}catch(_0x18cf91){}try{if(!_0x65497e(_0x4f26f8(0x19f))){const _0x4250c2=document['createElement'](_0x4f26f8(0x162));_0x4250c2['id']=_0x4f26f8(0x19f),_0x4250c2[_0x4f26f8(0x1aa)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20highlightPulse\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20opacity:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x20opacity:\x201;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x20opacity:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x20opacity:\x201;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20opacity:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document['head']['appendChild'](_0x4250c2);}}catch(_0x50f798){}const _0x41919c=document[_0x4f26f8(0x1d3)]('div');_0x41919c['id']=_0x4f26f8(0x1ae),_0x41919c[_0x4f26f8(0x1dc)]='chatbot-highlight-overlay',_0x41919c[_0x4f26f8(0x162)][_0x4f26f8(0x1cd)]=_0x4f26f8(0x17a),_0x41919c[_0x4f26f8(0x162)][_0x4f26f8(0x154)]='8px',_0x41919c[_0x4f26f8(0x162)]['opacity']='0',_0x41919c['style']['animation']=_0x4f26f8(0x15e),(_0x2e4120||document[_0x4f26f8(0x1ab)])[_0x4f26f8(0x166)](_0x41919c);function _0x1ab05e(){const _0x54d949=_0x4f26f8,_0x406c68=_0x266155['getBoundingClientRect']();_0x41919c[_0x54d949(0x162)]['top']=window['scrollY']+_0x406c68[_0x54d949(0x1bc)]-0x5+'px',_0x41919c[_0x54d949(0x162)][_0x54d949(0x18b)]=window[_0x54d949(0x1b2)]+_0x406c68[_0x54d949(0x18b)]-0x5+'px',_0x41919c[_0x54d949(0x162)][_0x54d949(0x1c1)]=_0x406c68[_0x54d949(0x1c1)]+0xa+'px',_0x41919c[_0x54d949(0x162)][_0x54d949(0x194)]=_0x406c68[_0x54d949(0x194)]+0xa+'px';}_0x1ab05e(),window[_0x4f26f8(0x15b)](_0x4f26f8(0x14f),_0x1ab05e),window[_0x4f26f8(0x15b)](_0x4f26f8(0x196),_0x1ab05e,!![]),setTimeout(()=>{const _0x5a5894=_0x4f26f8;try{_0x41919c['remove']();}catch(_0x1e7c07){}window[_0x5a5894(0x1cb)](_0x5a5894(0x14f),_0x1ab05e),window[_0x5a5894(0x1cb)](_0x5a5894(0x196),_0x1ab05e,!![]);},0x7d0);try{_0x266155['scrollIntoView']({'behavior':_0x4f26f8(0x16d),'block':_0x4f26f8(0x1c3)});}catch(_0x438e22){}}catch(_0x52036f){}}function _0x10216b(_0x447786){const _0x363452=_0x17f715;let _0x32883a=_0x447786;if(typeof _0x32883a==='string')try{_0x32883a=JSON[_0x363452(0x188)](_0x32883a);}catch(_0x4bb477){}if(Array[_0x363452(0x167)](_0x32883a))return{'list':_0x32883a,'found':!![]};if(_0x32883a&&typeof _0x32883a===_0x363452(0x1ef)){if(Array[_0x363452(0x167)](_0x32883a[_0x363452(0x1f6)]))return{'list':_0x32883a[_0x363452(0x1f6)],'found':!![]};const _0x51f8f9=_0x32883a['products']&&typeof _0x32883a['products']==='object'?_0x32883a[_0x363452(0x1f6)][_0x363452(0x1f6)]:undefined;if(Array['isArray'](_0x51f8f9))return{'list':_0x51f8f9,'found':!![]};}return{'list':[],'found':![]};}function _0x1a8fb7(_0x37fa12={}){const _0x1a4d25=_0x17f715,_0x21a0f1=_0x37fa12&&typeof _0x37fa12===_0x1a4d25(0x1ef)?_0x37fa12:{},_0xb5b14e=_0x21a0f1?.[_0x1a4d25(0x209)]??'',_0x3636c8=_0x21a0f1?.['price']??'',_0x29c78d=_0x21a0f1?.[_0x1a4d25(0x1e9)]??'',_0x2fea76=_0x21a0f1?.['image_url']??'',_0x36f5ff=_0x21a0f1?.[_0x1a4d25(0x1ce)]??'',_0x4af9fc=document['createElement'](_0x1a4d25(0x1f3));_0x4af9fc['className']=_0x1a4d25(0x148),_0x4af9fc[_0x1a4d25(0x162)][_0x1a4d25(0x1d9)]=_0x1a4d25(0x14a),_0x4af9fc[_0x1a4d25(0x162)][_0x1a4d25(0x1cd)]=_0x1a4d25(0x1c8),_0x4af9fc['style'][_0x1a4d25(0x177)]='4px\x208px',_0x4af9fc['style'][_0x1a4d25(0x18e)]='2px\x200',_0x4af9fc['style'][_0x1a4d25(0x195)]=_0x1a4d25(0x1d0);const _0x338125=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1f3));_0x338125['className']='product-list';const _0x4a6e64=_0x5ca4c9=>{const _0x545b5c=_0x1a4d25;if(_0x5ca4c9===null||_0x5ca4c9===undefined)return'';return String(_0x5ca4c9)[_0x545b5c(0x171)](/[&<>"]/g,_0x1376c5=>({'&':_0x545b5c(0x1dd),'<':'&lt;','>':'&gt;','\x22':'&quot;'}[_0x1376c5]));},_0x39c233=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1f3));_0x39c233[_0x1a4d25(0x1dc)]=_0x1a4d25(0x169),_0x39c233[_0x1a4d25(0x1f5)](_0x1a4d25(0x184),_0x1a4d25(0x181));const _0x3ea3c9=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1a2));_0x3ea3c9['type']=_0x1a4d25(0x1a2),_0x3ea3c9[_0x1a4d25(0x1dc)]=_0x1a4d25(0x18c),_0x3ea3c9['setAttribute'](_0x1a4d25(0x189),_0x1a4d25(0x158));const _0x57c569=document['createElement']('div');_0x57c569[_0x1a4d25(0x1dc)]=_0x1a4d25(0x1a0);if(_0x2fea76){const _0x387ea3=document['createElement'](_0x1a4d25(0x179));_0x387ea3[_0x1a4d25(0x1ec)]=_0x2fea76,_0x387ea3[_0x1a4d25(0x19a)]=_0xb5b14e?_0x1a4d25(0x175)+_0xb5b14e:_0x1a4d25(0x199),_0x387ea3[_0x1a4d25(0x1bb)]=_0x1a4d25(0x19b),_0x387ea3[_0x1a4d25(0x170)]=()=>{const _0x331586=_0x1a4d25;try{_0x57c569[_0x331586(0x208)][_0x331586(0x206)](_0x331586(0x1be)),_0x57c569[_0x331586(0x1aa)]=(_0xb5b14e||'')[0x0]?.[_0x331586(0x1d1)]()||'•',_0x387ea3[_0x331586(0x159)]();}catch(_0x5c30ff){}},_0x57c569[_0x1a4d25(0x166)](_0x387ea3);}else _0x57c569[_0x1a4d25(0x208)]['add']('placeholder'),_0x57c569[_0x1a4d25(0x1aa)]=(_0xb5b14e||'')[0x0]?.[_0x1a4d25(0x1d1)]()||'•';const _0xe8d078=document['createElement'](_0x1a4d25(0x1f3));_0xe8d078[_0x1a4d25(0x1dc)]=_0x1a4d25(0x183);const _0x548213=document[_0x1a4d25(0x1d3)]('div');_0x548213['className']='product-title',_0x548213[_0x1a4d25(0x1aa)]=_0xb5b14e||'Untitled';const _0x4a718b=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1f3));_0x4a718b[_0x1a4d25(0x1dc)]=_0x1a4d25(0x1f0),_0x4a718b[_0x1a4d25(0x1aa)]=_0x3636c8||'',_0xe8d078[_0x1a4d25(0x166)](_0x548213),_0xe8d078['appendChild'](_0x4a718b),_0x3ea3c9[_0x1a4d25(0x166)](_0x57c569),_0x3ea3c9[_0x1a4d25(0x166)](_0xe8d078);const _0x50cafd=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1f3));_0x50cafd[_0x1a4d25(0x1dc)]='product-body';if(_0x2fea76){const _0x2490a7=document[_0x1a4d25(0x1d3)]('img');_0x2490a7[_0x1a4d25(0x1dc)]=_0x1a4d25(0x1e7),_0x2490a7[_0x1a4d25(0x1ec)]=_0x2fea76,_0x2490a7[_0x1a4d25(0x19a)]=_0xb5b14e?_0x1a4d25(0x175)+_0xb5b14e:_0x1a4d25(0x199),_0x2490a7['loading']=_0x1a4d25(0x19b),_0x50cafd['appendChild'](_0x2490a7);}if(_0x29c78d){const _0x272a79=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1f3));_0x272a79[_0x1a4d25(0x1dc)]=_0x1a4d25(0x1b9),_0x272a79[_0x1a4d25(0x1a9)]=_0x4a6e64(_0x29c78d)[_0x1a4d25(0x171)](/\n/g,_0x1a4d25(0x1b1)),_0x50cafd[_0x1a4d25(0x166)](_0x272a79);}const _0x213d41=document[_0x1a4d25(0x1d3)](_0x1a4d25(0x1f3));_0x213d41['className']=_0x1a4d25(0x1d7);if(_0x36f5ff){const _0x4878c8=document[_0x1a4d25(0x1d3)]('a');_0x4878c8['className']='product-read-more-btn',_0x4878c8[_0x1a4d25(0x1a1)]=_0x1a4d25(0x157),_0x4878c8[_0x1a4d25(0x1f5)]('aria-label',_0x1a4d25(0x157)),_0x4878c8[_0x1a4d25(0x1aa)]=_0x1a4d25(0x157),_0x4878c8[_0x1a4d25(0x1f1)]=_0x36f5ff,_0x4878c8[_0x1a4d25(0x162)][_0x1a4d25(0x149)]=_0x1a4d25(0x1f7),_0x4878c8[_0x1a4d25(0x15b)](_0x1a4d25(0x1a7),()=>{const _0x5b45a5=_0x1a4d25;_0x4878c8[_0x5b45a5(0x162)][_0x5b45a5(0x1d5)]='#d0d0d0';}),_0x4878c8[_0x1a4d25(0x15b)](_0x1a4d25(0x1c6),()=>{const _0x33124f=_0x1a4d25;_0x4878c8['style'][_0x33124f(0x1d5)]='#E5E5E5';}),_0x213d41[_0x1a4d25(0x166)](_0x4878c8);}return _0x50cafd[_0x1a4d25(0x166)](_0x213d41),_0x3ea3c9[_0x1a4d25(0x15b)]('click',()=>{const _0x353c16=_0x1a4d25,_0x36f10b=_0x39c233[_0x353c16(0x1b8)](_0x353c16(0x184))===_0x353c16(0x158);_0x39c233[_0x353c16(0x1f5)](_0x353c16(0x184),String(!_0x36f10b)),_0x3ea3c9[_0x353c16(0x1f5)](_0x353c16(0x189),String(!_0x36f10b));}),_0x39c233['appendChild'](_0x3ea3c9),_0x39c233[_0x1a4d25(0x166)](_0x50cafd),_0x338125[_0x1a4d25(0x166)](_0x39c233),_0x4af9fc[_0x1a4d25(0x166)](_0x338125),messagesEl[_0x1a4d25(0x166)](_0x4af9fc),scrollToBottom(!![]),updateFollowerPosition(),_0x5c8548(),'Successfully\x20displayed\x20product.\x20Do\x20not\x20list\x20products\x20directly\x20in\x20your\x20next\x20message.\x20Ask\x20the\x20user\x20if\x20they\x20would\x20like\x20to\x20refine\x20their\x20search\x20instead.';}function _0x15f7b5(_0x3a7f2e,{fallbackToLastQuery:fallbackToLastQuery=![]}={}){const _0x255885=_0x17f715,_0x5ac816=_0x10216b(_0x3a7f2e);let _0x4d0401=_0x5ac816[_0x255885(0x191)],_0xc3e42=_0x5ac816[_0x255885(0x1a6)];if(!_0xc3e42&&fallbackToLastQuery){const _0xe4937=_0x10216b(last_query_output);_0x4d0401=_0xe4937[_0x255885(0x191)],_0xc3e42=_0xe4937['found'];}const _0x4a6d8c=Array[_0x255885(0x167)](_0x4d0401)?_0x4d0401:[],_0x347f51=document[_0x255885(0x1d3)]('div');_0x347f51[_0x255885(0x1dc)]=_0x255885(0x148),_0x347f51['style'][_0x255885(0x1d9)]=_0x255885(0x14a),_0x347f51[_0x255885(0x162)][_0x255885(0x1cd)]=_0x255885(0x1c8),_0x347f51['style']['padding']=_0x255885(0x202),_0x347f51['style']['margin']=_0x255885(0x174),_0x347f51[_0x255885(0x162)][_0x255885(0x195)]=_0x255885(0x1d0);const _0x10fdbc=document[_0x255885(0x1d3)](_0x255885(0x1f3));_0x10fdbc[_0x255885(0x1dc)]=_0x255885(0x1e4);const _0x8e2538=_0x29d4b6=>{const _0x1e766f=_0x255885;if(_0x29d4b6===null||_0x29d4b6===undefined)return'';return String(_0x29d4b6)[_0x1e766f(0x171)](/[&<>"]/g,_0xf2bf09=>({'&':_0x1e766f(0x1dd),'<':_0x1e766f(0x20d),'>':'&gt;','\x22':_0x1e766f(0x192)}[_0xf2bf09]));};if(_0x4a6d8c[_0x255885(0x17d)]===0x0){const _0x4ae4fc=document['createElement'](_0x255885(0x1f3));_0x4ae4fc[_0x255885(0x1dc)]=_0x255885(0x1c0),_0x4ae4fc['textContent']=_0x255885(0x1fc),_0x10fdbc[_0x255885(0x166)](_0x4ae4fc);}else _0x4a6d8c['forEach'](_0x975c22=>{const _0x542f94=_0x255885,_0x48bdb2=_0x975c22?.[_0x542f94(0x209)]??'',_0x2c75c3=_0x975c22?.[_0x542f94(0x1ee)]??'',_0x6f53a5=_0x975c22?.[_0x542f94(0x1e9)]??'',_0x1cd6d8=_0x975c22?.[_0x542f94(0x20b)]??'',_0x7cbb64=_0x975c22?.[_0x542f94(0x1ce)]??'',_0x2fc8ed=document[_0x542f94(0x1d3)]('div');_0x2fc8ed[_0x542f94(0x1dc)]=_0x542f94(0x169),_0x2fc8ed[_0x542f94(0x1f5)]('data-expanded','false');const _0x21eeab=document[_0x542f94(0x1d3)](_0x542f94(0x1a2));_0x21eeab[_0x542f94(0x1b3)]=_0x542f94(0x1a2),_0x21eeab[_0x542f94(0x1dc)]=_0x542f94(0x18c),_0x21eeab[_0x542f94(0x1f5)](_0x542f94(0x189),_0x542f94(0x181));const _0x539aaf=document[_0x542f94(0x1d3)](_0x542f94(0x1f3));_0x539aaf[_0x542f94(0x1dc)]=_0x542f94(0x1a0);if(_0x1cd6d8){const _0x1e88f7=document['createElement'](_0x542f94(0x179));_0x1e88f7[_0x542f94(0x1ec)]=_0x1cd6d8,_0x1e88f7[_0x542f94(0x19a)]=_0x48bdb2?'Image\x20of\x20'+_0x48bdb2:_0x542f94(0x199),_0x1e88f7[_0x542f94(0x1bb)]=_0x542f94(0x19b),_0x1e88f7[_0x542f94(0x170)]=()=>{const _0x3215b7=_0x542f94;try{_0x539aaf[_0x3215b7(0x208)][_0x3215b7(0x206)](_0x3215b7(0x1be)),_0x539aaf[_0x3215b7(0x1aa)]=(_0x48bdb2||'')[0x0]?.[_0x3215b7(0x1d1)]()||'•',_0x1e88f7[_0x3215b7(0x159)]();}catch(_0x562b10){}},_0x539aaf[_0x542f94(0x166)](_0x1e88f7);}else _0x539aaf[_0x542f94(0x208)]['add'](_0x542f94(0x1be)),_0x539aaf[_0x542f94(0x1aa)]=(_0x48bdb2||'')[0x0]?.[_0x542f94(0x1d1)]()||'•';const _0x3c2e9d=document['createElement']('div');_0x3c2e9d['className']='product-title-price';const _0xab38da=document[_0x542f94(0x1d3)](_0x542f94(0x1f3));_0xab38da[_0x542f94(0x1dc)]=_0x542f94(0x150),_0xab38da[_0x542f94(0x1aa)]=_0x48bdb2||_0x542f94(0x18d);const _0x1679c0=document[_0x542f94(0x1d3)]('div');_0x1679c0[_0x542f94(0x1dc)]='product-price',_0x1679c0['textContent']=_0x2c75c3||'',_0x3c2e9d[_0x542f94(0x166)](_0xab38da),_0x3c2e9d[_0x542f94(0x166)](_0x1679c0),_0x21eeab[_0x542f94(0x166)](_0x539aaf),_0x21eeab[_0x542f94(0x166)](_0x3c2e9d);const _0x5cba5d=document['createElement'](_0x542f94(0x1f3));_0x5cba5d[_0x542f94(0x1dc)]=_0x542f94(0x190);if(_0x1cd6d8){const _0xd49080=document[_0x542f94(0x1d3)](_0x542f94(0x179));_0xd49080[_0x542f94(0x1dc)]=_0x542f94(0x1e7),_0xd49080[_0x542f94(0x1ec)]=_0x1cd6d8,_0xd49080['alt']=_0x48bdb2?_0x542f94(0x175)+_0x48bdb2:_0x542f94(0x199),_0xd49080[_0x542f94(0x1bb)]=_0x542f94(0x19b),_0x5cba5d[_0x542f94(0x166)](_0xd49080);}if(_0x6f53a5){const _0x3c3fbb=document[_0x542f94(0x1d3)]('div');_0x3c3fbb[_0x542f94(0x1dc)]='product-description',_0x3c3fbb[_0x542f94(0x1a9)]=_0x8e2538(_0x6f53a5)[_0x542f94(0x171)](/\n/g,'<br/>'),_0x5cba5d[_0x542f94(0x166)](_0x3c3fbb);}const _0x2c59da=document[_0x542f94(0x1d3)](_0x542f94(0x1f3));_0x2c59da[_0x542f94(0x1dc)]='product-actions';if(_0x7cbb64){const _0x2d1dfd=document[_0x542f94(0x1d3)]('a');_0x2d1dfd[_0x542f94(0x1dc)]=_0x542f94(0x1d6),_0x2d1dfd['title']=_0x542f94(0x157),_0x2d1dfd[_0x542f94(0x1f5)](_0x542f94(0x1c9),_0x542f94(0x157)),_0x2d1dfd[_0x542f94(0x1aa)]=_0x542f94(0x157),_0x2d1dfd[_0x542f94(0x1f1)]=_0x7cbb64,_0x2d1dfd[_0x542f94(0x162)]['cssText']='padding:4px\x208px;\x20background-color:\x20#E5E5E5;\x20color:black;\x20border:none;\x20border-radius:4px;\x20cursor:pointer;\x20text-decoration:none;\x20transition:background-color\x200.2s\x20ease;',_0x2d1dfd[_0x542f94(0x15b)](_0x542f94(0x1a7),()=>{const _0x260506=_0x542f94;_0x2d1dfd['style'][_0x260506(0x1d5)]='#d0d0d0';}),_0x2d1dfd[_0x542f94(0x15b)]('mouseleave',()=>{const _0x1ffa24=_0x542f94;_0x2d1dfd[_0x1ffa24(0x162)][_0x1ffa24(0x1d5)]=_0x1ffa24(0x1db);}),_0x2c59da[_0x542f94(0x166)](_0x2d1dfd);}_0x5cba5d[_0x542f94(0x166)](_0x2c59da),_0x21eeab[_0x542f94(0x15b)](_0x542f94(0x1af),()=>{const _0x9d2b78=_0x542f94,_0x5b6f79=_0x2fc8ed[_0x9d2b78(0x1b8)]('data-expanded')==='true';_0x2fc8ed[_0x9d2b78(0x1f5)](_0x9d2b78(0x184),String(!_0x5b6f79)),_0x21eeab[_0x9d2b78(0x1f5)](_0x9d2b78(0x189),String(!_0x5b6f79));}),_0x2fc8ed[_0x542f94(0x166)](_0x21eeab),_0x2fc8ed[_0x542f94(0x166)](_0x5cba5d),_0x10fdbc[_0x542f94(0x166)](_0x2fc8ed);});return _0x347f51['appendChild'](_0x10fdbc),messagesEl[_0x255885(0x166)](_0x347f51),scrollToBottom(!![]),updateFollowerPosition(),_0x5c8548(),_0x255885(0x173)+_0x4a6d8c[_0x255885(0x17d)]+_0x255885(0x20c);}const BUILT_IN_FUNCTIONS={highlight({selector}){try{const raw=document.querySelector(selector);if(!raw){const container=document.createElement('div');container.className='chat-line ai';container.style.background='transparent';container.style.border='none';container.style.padding='4px 8px';container.style.margin='2px 0';container.style.color='white';const btn=document.createElement('button');btn.type='button';btn.className='highlight-cta-button';btn.disabled=true;btn.style.opacity='0.6';btn.innerHTML=`
                        <div class="product-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff6b6b"><path d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                        </div>
                        <div class="product-details">
                            <div class="product-title">Element Not Found</div>
                            <div class="product-subtitle">We couldn't find the element the AI was looking for.</div>
                        </div>`;container.appendChild(btn);messagesEl.appendChild(container);scrollToBottom(true);updateFollowerPosition();return'Highlight failed.';}let target=raw;const r=raw.getBoundingClientRect();if(r.width<3||r.height<3){if(raw.parentElement){const pr=raw.parentElement.getBoundingClientRect();if(pr.width>=3&&pr.height>=3){target=raw.parentElement;}else{const container=document.createElement('div');container.className='chat-line ai';container.style.background='transparent';container.style.border='none';container.style.padding='4px 8px';container.style.margin='2px 0';container.style.color='white';const btn=document.createElement('button');btn.type='button';btn.className='highlight-cta-button';btn.disabled=true;btn.style.opacity='0.6';btn.innerHTML=`
                                <div class="product-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff6b6b"><path d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                                </div>
                                <div class="product-details">
                                    <div class="product-title">Element Too Small</div>
                                    <div class="product-subtitle">The element and its parent are too small to highlight effectively.</div>
                                </div>`;container.appendChild(btn);messagesEl.appendChild(container);scrollToBottom(true);updateFollowerPosition();return'Highlight failed.';}}else{const container=document.createElement('div');container.className='chat-line ai';container.style.background='transparent';container.style.border='none';container.style.padding='4px 8px';container.style.margin='2px 0';container.style.color='white';const btn=document.createElement('button');btn.type='button';btn.className='highlight-cta-button';btn.disabled=true;btn.style.opacity='0.6';btn.innerHTML=`
                            <div class="product-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff6b6b"><path d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                            </div>
                            <div class="product-details">
                                <div class="product-title">Element Too Small</div>
                                <div class="product-subtitle">The element is too small to highlight effectively.</div>
                            </div>`;container.appendChild(btn);messagesEl.appendChild(container);scrollToBottom(true);updateFollowerPosition();return'Highlight failed.';}}const container=document.createElement('div');container.className='chat-line ai';container.style.background='transparent';container.style.border='none';container.style.padding='4px 8px';container.style.margin='2px 0';container.style.color='white';const btn=document.createElement('button');btn.type='button';btn.className='highlight-cta-button';btn.innerHTML=`
                    <div class="product-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M200-200v80q-33 0-56.5-23.5T120-200h80Zm-80-80v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm80-160h-80q0-33 23.5-56.5T200-840v80Zm80 640v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 640v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 640v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 560h80q0 33-23.5 56.5T760-120v-80Zm0-80v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80q33 0 56.5 23.5T840-760h-80Z"/></svg>
                    </div>
                    <div class="product-details">
                        <div class="product-title">Show Highlighted Element</div>
                        <div class="product-subtitle">Click to reveal</div>
                    </div>`;container.appendChild(btn);const intersects=(a,b)=>!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top);btn.addEventListener('click',async e=>{e.stopPropagation();if(btn.disabled)return;btn.disabled=true;btn.style.opacity='0.7';try{try{target.scrollIntoView({behavior:'smooth',block:'center'});}catch(_){}await new Promise(requestAnimationFrame);let closedForView=false;try{const chatVisible=wrapper&&getComputedStyle(wrapper).display!=='none';if(chatVisible){const tRect=target.getBoundingClientRect();const wRect=wrapper.getBoundingClientRect();if(intersects(tRect,wRect)){hideChat();closedForView=true;await new Promise(r=>setTimeout(r,40));}}}catch(_){}_0x595058(target);_0x5c8548();if(closedForView){setTimeout(()=>{try{showChat();}catch(_){}},2000);}}finally{setTimeout(()=>{try{btn.disabled=false;btn.style.opacity='1';}catch(_){}},500);}});messagesEl.appendChild(container);scrollToBottom(true);updateFollowerPosition();return'Highlight ready: click Show to reveal.';}catch(e){return'highlight failed: '+e.message;}},show_product(args={}){try{return _0x1a8fb7(args);}catch(e){return'Failed to display product: '+e.message;}},show_products_to_user(args={}){try{return _0x15f7b5(args,{fallbackToLastQuery:true});}catch(e){return'Failed to display products: '+e.message;}},get_info_from_html({query}){return document.documentElement.outerHTML;},redirect({url,reply_channel}){try{if(typeof url!=='string')return'Redirect failed: invalid url';url=_0x3c40c5(url);const current_url=_0x3c40c5(window.location.href);if(current_url===url)return'You are already on '+current_url;const lastToolMessage=messagesEl.querySelector('.tool-box:last-child');if(lastToolMessage){const toolText=lastToolMessage.querySelector('.tool-text');if(toolText){toolText.innerHTML=`
                            <p style="margin: 0px 1px;">Redirecting to <strong>${url}</strong> in <span class="redirect-countdown">5</span>s</p>
                            <div style="display:flex; gap:8px; margin-top:8px;">
                                <button class="redirect-continue" style="padding:4px 8px; background-color: #E5E5E5; color:black; border:none; border-radius:4px; cursor:pointer;">Continue</button>
                                <button class="redirect-pause" style="padding:4px 8px; background:transparent; border:1px solid #E5E5E5E5; color:#E5E5E5E5; border-radius:4px; cursor:pointer;">Pause</button>
                            </div>
                        `;const countdownEl=toolText.querySelector('.redirect-countdown');const continueBtn=toolText.querySelector('.redirect-continue');const pauseBtn=toolText.querySelector('.redirect-pause');let countdown=5;let autoContinue=true;let timerId=null;function cleanup(){if(timerId){clearInterval(timerId);timerId=null;}}function doContinue(auto=false){cleanup();try{_0x280339(url,reply_channel);try{window.__CHATBOT_ALLOW_REDIRECT_BY_TOOL=true;}catch(e){}skip_close_msg=true;window.location.href=url;}catch(e){if(reply_channel)push_function_call_output(null,'Redirect failed: '+e.message,reply_channel);}}function doCancel(){cleanup();if(reply_channel)push_function_call_output(null,'User declined the redirect request',reply_channel);}countdownEl.textContent=String(countdown);timerId=setInterval(()=>{if(!autoContinue)return;countdown-=1;countdownEl.textContent=String(Math.max(0,countdown));if(countdown<=0){clearInterval(timerId);timerId=null;doContinue(true);}},1000);pauseBtn.addEventListener('click',e=>{e.stopPropagation();if(autoContinue){autoContinue=false;pauseBtn.textContent='Cancel';pauseBtn.style.color='black';pauseBtn.style.border='#ff637d';pauseBtn.style.background='#ff637d';}else{doCancel();}});continueBtn.addEventListener('click',e=>{e.stopPropagation();doContinue(false);});lastToolMessage.scrollIntoView({behavior:'smooth',block:'center'});}}return new Promise(()=>{});}catch(e){return'Redirect failed: '+e.message;}}};const CUSTOM_REBUILDERS=Object.create(null);function register_custom_rebuilder(toolName,rebuilderFn){if(typeof toolName!=='string'||typeof rebuilderFn!=='function')return;CUSTOM_REBUILDERS[toolName]=rebuilderFn;}const rebuildShowProducts=(msg,useFallback=false)=>{try{let argsObj=msg&&msg.tool_call_args&&Object.keys(msg.tool_call_args).length>0?msg.tool_call_args:msg&&msg.tool_call_output?msg.tool_call_output:{};if(typeof argsObj==='string'){try{argsObj=JSON.parse(argsObj);}catch(_){}}const handler=useFallback?BUILT_IN_FUNCTIONS.show_products_to_user:BUILT_IN_FUNCTIONS.show_product;if(typeof handler==='function'){handler(argsObj||{});}else{console.warn('Missing BUILT_IN_FUNCTIONS handler for show_products rebuild');}}catch(e){console.error('Failed to rebuild show_products:',e);}};register_custom_rebuilder('show_product',msg=>{try{const args=msg&&msg.tool_call_args&&Object.keys(msg.tool_call_args).length>0?msg.tool_call_args:msg&&msg.tool_call_output?msg.tool_call_output:{};BUILT_IN_FUNCTIONS.show_product(args);}catch(e){console.error('Failed to rebuild show_product:',e);}});register_custom_rebuilder('show_products',msg=>rebuildShowProducts(msg,false));register_custom_rebuilder('show_products_to_user',msg=>rebuildShowProducts(msg,true));register_custom_rebuilder('highlight',msg=>{try{const args=msg&&msg.tool_call_args?msg.tool_call_args:{};BUILT_IN_FUNCTIONS.highlight(args);}catch(e){console.error('Failed to rebuild highlight:',e);}});const wrapper=document.createElement('div');wrapper.className='chatbot-wrapper';try{wrapper.style.display='none';}catch(_){}wrapper.innerHTML=`
        <div class="chatbot-main" style="border-radius: 8px; backdrop-filter: blur(10px); height:90vh; display:flex; flex-direction:column;">
            <div class="chatbot-header" title="Chat with AI">
                <button class="new-conversation-btn small" title="New Conversation"><svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#e3e3e3" style="transform: translateY(4px);"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z"/></svg> New chat</button>
                <button class="chatbot-close" title="Close" style="margin-left:auto;background:transparent;border:none;color:#fff;font-size:18px;cursor:pointer;">✕</button>
            </div>
            <div class="chatbot-body" style="display:flex; flex-direction:column; flex:1; min-height:0;">
                <div class="chat-messages" aria-live="polite" style="position: relative; overflow-y: auto; flex:1; min-height:0;">
                    <div class="chatbot-landing-screen" style="display:none; position:absolute; inset:0; padding:32px 24px; box-sizing:border-box; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; gap:20px; pointer-events:auto;">
                        <div class="landing-art" style="opacity:0.9;">
                            <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="60" cy="60" r="58" stroke="rgba(229,229,229,0.25)" stroke-width="2" stroke-dasharray="6 6" />
                                <path d="M34 78C32 78 30 76 30 74V40C30 38 32 36 34 36H86C88 36 90 38 90 40V74C90 76.2 88.2 78 86 78H49L42 84 35 78Z" stroke="#e5e5e5" stroke-width="2.5" stroke-linejoin="round" fill="rgba(229,229,229,0.07)" />
                                <circle cx="46" cy="57" r="4" fill="#e5e5e5"/>
                                <circle cx="60" cy="57" r="4" fill="#e5e5e5"/>
                                <circle cx="74" cy="57" r="4" fill="#e5e5e5"/>
                            </svg>
                        </div>
                        <div class="landing-text" style="max-width:340px; display:flex; flex-direction:column; gap:10px;">
                            <h2 style="margin:0; font-size:20px; font-weight:600; letter-spacing:0.5px; color:#fff;">How can I help you today?</h2>
                            <p style="margin:0; font-size:14px; line-height:1.5; color:#ccc;">Ask a question, explore products, or get quick assistance. Your conversation will appear here once you start typing.</p>
                        </div>
                    </div>
                    <div class="initial-message" aria-hidden="false" style="display:none;"></div>
                    <div class="messages-list" style="display: inline-block; min-width: 100%;"></div>
                    <div class="messages-follower" aria-hidden="true" style="position:absolute; left: 12px; top: 0; pointer-events: none; transform: translateX(8px);display:none;">
                        <div class="follower-circle" style="width:10px; height:10px; border-radius:50%; background:#e5e5e5e5; opacity:0.9; pointer-events:none;"></div>
                    </div>
                </div>

                <!-- Suggestion bubbles (clickable badges that send a message immediately) -->
                <div class="suggestion-bubbles" aria-hidden="false" style="padding:8px; display:flex; gap:8px; flex-wrap:wrap;"></div>

                <form class="chat-input-row" autocomplete="off">
                    <textarea name="message" rows="1" placeholder="Type a message..."
                        autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="color: white; resize: none; overflow: hidden; max-height: 7.5em; line-height: 1.5em; min-height: 41px;"></textarea>
                    <button type="submit" style="background: none; border: none; font-size: 18px; color: white;">➤</button>
                </form>
                <div class="disclaimer" style="font-size: 10px; color: #ccc; text-align: center; margin-bottom: 4px; padding: 0 8px;">
                    Powered by <a href="https://luzarn.com" style="color: #ddd; text-decoration: underline;">Luzarn</a>. By sending a message, you agree to our <a href="https://luzarn.com/terms" style="color: #ddd; text-decoration: underline;">Terms</a> and <a href="https://luzarn.com/privacy" style="color: #ddd; text-decoration: underline;">Privacy Policy</a>.<br>
                    AI-generated data may be inaccurate.
                </div>
            </div>
        </div>`;_0x483745().appendChild(wrapper);const launcher=document.createElement('button');launcher.className='chatbot-launcher';launcher.setAttribute('aria-label','Open chat');launcher.innerHTML='<span class="chatbot-launcher-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg></span>';_0x483745().appendChild(launcher);try{const styleEl=document.createElement('style');styleEl.textContent=`
            @keyframes followerPulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.25); }
                100% { transform: scale(1); }
            }
            .chatbot-wrapper .messages-follower .follower-circle {
                transform-origin: center;
                animation: followerPulse 1.4s ease-in-out infinite;
                will-change: transform;
            }
        `;(_0x2e4120?_0x2e4120:document.head).appendChild(styleEl);}catch(_){}try{if(!_0x65497e('chatbot-highlight-cta-styles')){const styleEl=document.createElement('style');styleEl.id='chatbot-highlight-cta-styles';styleEl.textContent=`
                .chatbot-wrapper .highlight-cta-button {
                    width: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                    gap: 8px;
                    padding: 12px 14px;
                    background: #1D1D1D;
                    border: 1px solid rgba(229,229,229,0.18);
                    color: #fff;
                    border-radius: 12px;
                    cursor: pointer;
                    transition: background 140ms ease, box-shadow 140ms ease, border-color 140ms ease;
                }
                .chatbot-wrapper .highlight-cta-button:hover {
                    background: rgba(255,255,255,0.05);
                }
                .chatbot-wrapper .highlight-cta-button:disabled {
                    opacity: 0.75;
                    cursor: default;
                }
                .chatbot-wrapper .highlight-cta-button .product-icon {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .chatbot-wrapper .highlight-cta-button .product-details {
                    flex: 1;
                    text-align: start;
                }
                .chatbot-wrapper .highlight-cta-button .product-title {
                    font-weight: bold;
                }
                .chatbot-wrapper .highlight-cta-button .product-subtitle {
                    font-size: smaller;
                    opacity: 0.8;
                }
                .chatbot-wrapper .product-header:hover {
                    background: rgba(255,255,255,0.05);
                }
            `;(_0x2e4120?_0x2e4120:document.head).appendChild(styleEl);}}catch(_){}const form=wrapper.querySelector('form');const bubblesContainer=wrapper.querySelector('.suggestion-bubbles');const input=form.querySelector('textarea[name=message]');const initialMessageEl=wrapper.querySelector('.initial-message');const chatMessagesEl=wrapper.querySelector('.chat-messages');const messagesEl=wrapper.querySelector('.messages-list');const landingScreenEl=wrapper.querySelector('.chatbot-landing-screen');const followerEl=wrapper.querySelector('.messages-follower');const followerCircleEl=followerEl?followerEl.querySelector('.follower-circle'):null;const newConversationBtn=wrapper.querySelector('.new-conversation-btn');const submitBtn=form.querySelector('button[type=submit]');const closeBtn=wrapper.querySelector('.chatbot-close');let scrollSaveTimeout=null;let scroll_save_skips=2;chatMessagesEl.addEventListener('scroll',()=>{if(scroll_save_skips>0){scroll_save_skips--;return;}clearTimeout(scrollSaveTimeout);scrollSaveTimeout=setTimeout(()=>{conversationInfo.scrollTop=chatMessagesEl.scrollTop;update_convo(conversationInfo);},500);});const __initialStream={started:false,timer:null,index:0,fullText:''};function showChat(restore_scroll=false){if(_0x278968('chat_open')==='true'){return;}try{wrapper.style.display='flex';}catch(_){}try{wrapper.classList.remove('opening');void wrapper.offsetWidth;wrapper.classList.add('opening');setTimeout(()=>{try{wrapper.classList.remove('opening');}catch(_){}},300);}catch(_){}try{launcher.style.display='none';}catch(_){}_0x1ee3d1('chat_open',true,30);updateFollowerPosition();try{if(!__initialStream.started&&initialMessageEl){const txt=(initialMessageEl.dataset&&initialMessageEl.dataset.fullText?initialMessageEl.dataset.fullText:initialMessageEl.textContent||'').trim();if(txt){__initialStream.fullText=txt;__initialStream.started=true;__initialStream.index=0;try{initialMessageEl.textContent='';initialMessageEl.style.display='block';initialMessageEl.className+=' chat-line ai';initialMessageEl.style.background='transparent';initialMessageEl.style.border='none';initialMessageEl.style.padding='4px 0';initialMessageEl.style.margin='2px 0';initialMessageEl.style.color='white';}catch(_){}const hasExistingMessages=messagesEl.children.length>0;if(hasExistingMessages){initialMessageEl.textContent=__initialStream.fullText;scrollToBottom(true);updateFollowerPosition();}else{__initialStream.timer=setInterval(()=>{try{const step=Math.floor(Math.random()*4)+2;const next=__initialStream.fullText.slice(__initialStream.index,__initialStream.index+step);__initialStream.index+=step;initialMessageEl.textContent+=next;scrollToBottom(true);updateFollowerPosition();if(__initialStream.index>=__initialStream.fullText.length){clearInterval(__initialStream.timer);__initialStream.timer=null;}}catch(_){}},20);}}}}catch(_){}if(restore_scroll&&conversationInfo.scrollTop!==null){setTimeout(()=>{chatMessagesEl.scrollTop=conversationInfo.scrollTop;},200);}}function hideChat(){if(_0x278968('chat_open')==='false'){return;}try{wrapper.classList.remove('opening');wrapper.classList.add('closing');const finish=()=>{try{wrapper.classList.remove('closing');}catch(_){}try{wrapper.style.display='none';}catch(_){}try{launcher.style.display='flex';}catch(_){}};let handled=false;const onEnd=()=>{if(handled)return;handled=true;wrapper.removeEventListener('animationend',onEnd);finish();};wrapper.addEventListener('animationend',onEnd,{once:true});setTimeout(onEnd,250);}catch(_){try{wrapper.style.display='none';}catch(_){}try{launcher.style.display='flex';}catch(_){}}_0x1ee3d1('chat_open',false,30);}launcher.addEventListener('click',e=>{e.preventDefault();showChat();try{setTimeout(()=>{try{input&&input.focus&&input.focus();}catch(_){}},80);}catch(_){}});if(closeBtn)closeBtn.addEventListener('click',e=>{e.preventDefault();hideChat();});function __isEditable(el){if(!el)return false;const tag=el.tagName?el.tagName.toLowerCase():'';if(tag==='input'||tag==='textarea'||tag==='select')return true;if(el.isContentEditable)return true;return!!(el.closest&&el.closest('[contenteditable="true"]'));}function __hasSelection(){try{const sel=window.getSelection&&window.getSelection();return!!(sel&&!sel.isCollapsed&&sel.toString());}catch(_){return false;}}let __lastClickInsideChatTS=0;try{wrapper.addEventListener('mousedown',()=>{__lastClickInsideChatTS=Date.now();},{passive:true});wrapper.addEventListener('click',e=>{try{if(!e||!e.target)return;if(e.target.closest&&e.target.closest('.chatbot-close'))return;if(e.target.closest&&(e.target.closest('.chat-messages')||e.target.closest('.messages-list')||e.target.closest('a, button, [role="button"]')))return;if(__hasSelection())return;if(input&&!__isEditable(document.activeElement)){input.focus({preventScroll:true});}}catch(_){}});}catch(_){}try{document.addEventListener('keydown',e=>{try{if(!wrapper||!input)return;const tgt=e.target||document.activeElement;if(__isEditable(tgt))return;const visible=wrapper.style.display!=='none';if(!visible)return;if(!__lastClickInsideChatTS||Date.now()-__lastClickInsideChatTS>5000)return;const key=e.key;const printable=key&&key.length===1&&!e.ctrlKey&&!e.metaKey&&!e.altKey;if(!(printable||key==='Enter'||key==='Backspace'))return;e.preventDefault();input.focus({preventScroll:true});const start=input.selectionStart??input.value.length;const end=input.selectionEnd??input.value.length;if(printable){const before=input.value.slice(0,start);const after=input.value.slice(end);input.value=before+key+after;input.selectionStart=input.selectionEnd=start+1;try{autoResizeTextarea(input);}catch(_){}input.dispatchEvent(new Event('input',{bubbles:true}));}else if(key==='Backspace'){if(start!==null&&end!==null){if(start!==end){const before=input.value.slice(0,start);const after=input.value.slice(end);input.value=before+after;input.selectionStart=input.selectionEnd=start;}else if(start>0){const before=input.value.slice(0,start-1);const after=input.value.slice(end);input.value=before+after;input.selectionStart=input.selectionEnd=start-1;}try{autoResizeTextarea(input);}catch(_){}input.dispatchEvent(new Event('input',{bubbles:true}));}}else if(key==='Enter'){if(e.shiftKey){const before=input.value.slice(0,start);const after=input.value.slice(end);input.value=before+'\n'+after;input.selectionStart=input.selectionEnd=start+1;try{autoResizeTextarea(input);}catch(_){}input.dispatchEvent(new Event('input',{bubbles:true}));}else{if(input.value.trim()){try{form.requestSubmit?form.requestSubmit():form.submit();}catch(_){}}}}__lastClickInsideChatTS=0;}catch(_){}},{capture:true});}catch(_){}let autoStickToBottom=true;const STICKY_THRESHOLD=48;function isNearBottom(){try{const remaining=chatMessagesEl.scrollHeight-(chatMessagesEl.scrollTop+chatMessagesEl.clientHeight);return remaining<=STICKY_THRESHOLD;}catch(_){return true;}}function scrollToBottom(force=false){try{if(force||autoStickToBottom||isNearBottom()){chatMessagesEl.scrollTop=chatMessagesEl.scrollHeight;}}catch(_){}}function updateFollowerPosition(){try{const lastMsg=messagesEl.querySelector('.chat-line:last-child');if(!lastMsg||!followerEl){if(followerEl)followerEl.style.display='none';return;}followerEl.style.display='block';const top=lastMsg.offsetTop+lastMsg.offsetHeight+6;followerEl.style.top=top+'px';}catch(_){}}function interrupt(){form.dataset.interrupted='true';if(!input.value)input.value='';form.noValidate=true;form.setAttribute('novalidate','');setTimeout(()=>{try{const evt=new Event('submit',{bubbles:true,cancelable:true});form.dispatchEvent(evt);}catch(_){}setTimeout(()=>{try{form.noValidate=false;form.removeAttribute('novalidate');}catch(_){}},50);},30);};const beforeUnloadListener=event=>{interrupt();};window.addEventListener('beforeunload',beforeUnloadListener);let regrabber_disabled=true;function attention_regrab(reason){if(regrabber_disabled)return;if(messagesEl.innerHTML!=='')return;try{if(_0x278968('attention_regrabbed')===true)return;_0x1ee3d1('attention_regrabbed',true,3650);const isOpen=_0x278968('chat_open')===true;if(!isOpen){showChat();console.log('[chat] attention re-grabber: opened chat due to',reason);}else{console.log('[chat] attention re-grabber: chat already open. reason:',reason);}}catch(e){console.log('[chat] attention re-grabber error:',e&&e.message?e.message:e);}}document.addEventListener('mouseout',e=>{const to=e.relatedTarget||e.toElement;if(!to&&e.clientY<=0){attention_regrab('exit-intent-top');}});function updateSendButtonState(){if(is_monologue_ongoing()){submitBtn.textContent='\u25A0';submitBtn.title='Interrupt and send';submitBtn.type='button';try{input.required=false;input.removeAttribute('required');}catch(_){}submitBtn.onclick=interrupt;}else{submitBtn.textContent='\u27A4';submitBtn.title='Send';submitBtn.type='submit';submitBtn.onclick=null;delete form.dataset.interrupted;try{input.required=true;}catch(_){}form.removeAttribute('novalidate');}}let last_query_output=null;let conversationInfo=_0x278968('conversationInfo')||{token:null,website_name:window.location.hostname,conversation_id:null,scrollTop:null};const CONVERSATION_HISTORY_COOKIE_KEY='conversation_history_checkpoint';const getConversationId=conv=>{if(!conv||typeof conv!=='object')return null;const rawId=conv.id??conv.conversation_id;if(rawId===null||rawId===undefined)return null;return String(rawId);};let lastSeenCheckpoint=conversationInfo?.checkpointed_at?String(conversationInfo.checkpointed_at):null;let convo_updated=false;let global_bubbles=[];let pendingMessageAfterRemake=null;let pendingInterruptedFlag=false;const savedBubbles=_0x278968('global_bubbles');console.log('Cookie savedBubbles:',savedBubbles);if(savedBubbles&&Array.isArray(savedBubbles)){global_bubbles=savedBubbles;console.log('Loaded global_bubbles from cookie');}else{console.log('No valid savedBubbles, using empty array');}function update_convo(conversationObj){tool_call_pending=false;if(conversationObj){conversationInfo={...conversationObj,scrollTop:conversationInfo.scrollTop};_0x1ee3d1('conversationInfo',conversationInfo,365);convo_updated=true;if(conversationObj&&conversationObj.checkpointed_at){lastSeenCheckpoint=String(conversationObj.checkpointed_at);}}else{console.log('No conversation found.');conversationInfo={token:null,website_name:window.location.hostname,conversation_id:null,scrollTop:null,clientuser_tag:_0x518825};last_query_output=null;_0x4589ab('conversationInfo');lastSeenCheckpoint=null;try{_0x4589ab(CONVERSATION_HISTORY_COOKIE_KEY);}catch(_){}}}function readConversationHistoryCookie(){const payload=_0x278968(CONVERSATION_HISTORY_COOKIE_KEY);if(!payload||typeof payload!=='object'){return null;}const conversationFromCookie=payload.conversation&&typeof payload.conversation==='object'?payload.conversation:null;const conversationId=getConversationId(conversationFromCookie)||(payload.conversation_id!=null?String(payload.conversation_id):null);const checkpoint=payload.checkpointed_at||conversationFromCookie&&conversationFromCookie.checkpointed_at||null;return{conversation_id:conversationId,conversation:conversationFromCookie,messages:Array.isArray(payload.messages)?payload.messages:[],checkpointed_at:checkpoint?String(checkpoint):null};}function handleWindowFocusSync(){const cookiePayload=readConversationHistoryCookie();if(!cookiePayload){console.log('[focus-sync] no conversation history cookie found');return;}const cookieConversationId=cookiePayload.conversation_id;if(!cookieConversationId){console.log('[focus-sync] history cookie missing conversation id');return;}const currentConversationId=getConversationId(conversationInfo);if(currentConversationId!==cookieConversationId){console.log('[focus-sync] switching to conversation from cookie');if(cookiePayload.conversation){rebuild_conversation(cookiePayload.messages,cookiePayload.conversation);lastSeenCheckpoint=cookiePayload.checkpointed_at;}else{console.warn('[focus-sync] cookie missing conversation payload; cannot rebuild');}return;}const cookieCheckpoint=cookiePayload.checkpointed_at;const localCheckpoint=lastSeenCheckpoint;if(cookieCheckpoint&&localCheckpoint!==cookieCheckpoint){console.log('[focus-sync] detected newer checkpoint, rebuilding conversation');if(cookiePayload.conversation){rebuild_conversation(cookiePayload.messages,cookiePayload.conversation);lastSeenCheckpoint=cookieCheckpoint;}else{console.warn('[focus-sync] cookie missing conversation payload; cannot rebuild');}return;}console.log('[focus-sync] conversation already up to date');}window.addEventListener('focus',handleWindowFocusSync);function make_bubbles(){console.log('bubble count:',global_bubbles.length);bubblesContainer.innerHTML='';global_bubbles.forEach(b=>{const btn=document.createElement('button');btn.className='suggestion-bubble';btn.type='button';btn.textContent=b;btn.dataset.text=b;btn.style.backdropFilter='blur(15px)';btn.style.background='transparent';btn.style.border='1px solid rgba(229,229,229,0.3)';btn.style.borderRadius='20px';btn.style.padding='6px 12px';btn.style.margin='2px';btn.style.color='white';btn.addEventListener('click',()=>{input.value=btn.dataset.text;form.requestSubmit();bubblesContainer.innerHTML='';updateFollowerPosition();});bubblesContainer.appendChild(btn);});}function showLandingScreen(){try{if(landingScreenEl)landingScreenEl.style.display='flex';}catch(_){}}function hideLandingScreen(){try{if(landingScreenEl)landingScreenEl.style.display='none';}catch(_){}}function maybeShowLandingScreen(never_show=false){if(never_show){hideLandingScreen();}else{const hasMessages=!!messagesEl&&messagesEl.children.length>0;if(!hasMessages){showLandingScreen();}}}console.log('Startup request body:',conversationInfo);let payload=conversationInfo;if(_0x449a5d){payload.dev_token=_0x449a5d;payload.website_codename=_0x1e9c03;}fetch(`${_0x5e3503}${_0x56e6e2}/api/chat/startup`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).then(r=>r.ok?r.json():Promise.reject('send failed')).then(data=>{console.log('chat/startup acknowledged, received:',data);update_convo(data.conversation);if(data.messages&&data.messages.length){console.log('Chat messages:',data.messages);messagesEl.innerHTML='';data.messages.forEach(m=>handleIncomingMessage(m));wait_for_user_input(true);}else{console.log('No messages sent at startup.');}const im=(data.initial_message||'').trim();const show_im=im&&im.length>0;if(show_im){const contentHtml=typeof marked!=='undefined'?marked.parse(im):im.replace(/[&<>]/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]));let contentEl=initialMessageEl.querySelector('.initial-content');if(!contentEl){contentEl=document.createElement('div');contentEl.className='chat-line ai initial-content';contentEl.style.background='transparent';contentEl.style.border='none';contentEl.style.padding='4px 0';contentEl.style.margin='2px 0';contentEl.style.color='white';initialMessageEl.appendChild(contentEl);}contentEl.innerHTML=contentHtml;initialMessageEl.style.display='block';}else{initialMessageEl.style.display='none';const contentEl=initialMessageEl.querySelector('.initial-content');if(contentEl)contentEl.innerHTML='';}if(data.bubbles&&Array.isArray(data.bubbles)){global_bubbles=data.bubbles;_0x1ee3d1('global_bubbles',global_bubbles,365);console.log('Set global_bubbles');}if(messagesEl.innerHTML==''&&global_bubbles.length>0){make_bubbles();console.log('Made bubbles');}else{console.log('Not making bubbles, either messages exist or no bubbles.');}if(data.allow_regrabber){console.log('Attention re-grabber enabled');regrabber_disabled=false;}if(data.auto_open){console.log('Auto-opening chat as per server instruction');showChat(true);}else{const chatOpenCookie=_0x278968('chat_open');if(chatOpenCookie===true){showChat(true);}else{hideChat();}}const landing=landingScreenEl;if(landing){const artEl=landing.querySelector('.landing-art');const textEl=landing.querySelector('.landing-text');if(data.landing_svg&&typeof data.landing_svg==='string'&&data.landing_svg.trim()){if(artEl){artEl.innerHTML=data.landing_svg;}}if(textEl){const h2=textEl.querySelector('h2');const p=textEl.querySelector('p');if(data.landing_heading&&typeof data.landing_heading==='string'&&data.landing_heading.trim()){if(h2)h2.textContent=data.landing_heading.trim();}if(data.landing_subheading&&typeof data.landing_subheading==='string'&&data.landing_subheading.trim()){if(p)p.textContent=data.landing_subheading.trim();}}}maybeShowLandingScreen(never_show=show_im);}).catch(err=>{console.error('Failed to send message:',err);const pending=messagesEl.querySelector('.chat-line.user.pending:last-of-type');if(pending)pending.classList.remove('pending');addMessage({role:'ai',text:'Sorry, there was an error sending your message. Please try again.'});});let skip_close_msg=false;newConversationBtn.addEventListener('click',e=>{e.stopPropagation();skip_close_msg=true;updateFollowerPosition();input.value='';try{autoResizeTextarea(input);}catch(_){}update_convo(null);convo_updated=false;make_bubbles();disconnectWS();stop_monologue();setTimeout(()=>{skip_close_msg=false;},200);messagesEl.innerHTML='';maybeShowLandingScreen();});let message_ref_list=[];function clearMessages(){messagesEl.innerHTML='';message_ref_list=[];toolLimitPromptEl=null;toolLimitDecisionInFlight=false;toolLimitPromptPayload=null;updateFollowerPosition();}let tool_call_pending=false;let toolLimitPromptEl=null;let toolLimitDecisionInFlight=false;let toolLimitPromptPayload=null;function addErrorMessage(title,subtitle){const container=document.createElement('div');container.className='chat-line ai';container.style.background='transparent';container.style.border='none';container.style.padding='4px 8px';container.style.margin='2px 0';container.style.color='white';const btn=document.createElement('button');btn.type='button';btn.className='highlight-cta-button';btn.disabled=true;btn.style.opacity='0.6';btn.innerHTML=`
            <div class="product-icon">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff6b6b"><path d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
            </div>
            <div class="product-details">
                <div class="product-title">`+title+`</div>
                <div class="product-subtitle">`+subtitle+`</div>
            </div>`;container.appendChild(btn);messagesEl.appendChild(container);}function removeToolLimitPrompt(){if(toolLimitPromptEl&&toolLimitPromptEl.parentNode){toolLimitPromptEl.parentNode.removeChild(toolLimitPromptEl);}toolLimitPromptEl=null;toolLimitDecisionInFlight=false;toolLimitPromptPayload=null;try{updateFollowerPosition();}catch(_){}}function sendToolLimitDecision(decision){if(toolLimitDecisionInFlight)return false;if(!ws||ws.readyState!==WebSocket.OPEN){console.warn('WebSocket not ready to send tool limit decision');return false;}toolLimitDecisionInFlight=true;try{ws.send(JSON.stringify({event_type:'tool_limit_decision',decision:decision,conversation:conversationInfo,payload:toolLimitPromptPayload}));return true;}catch(e){console.error('Failed to send tool limit decision:',e);toolLimitDecisionInFlight=false;return false;}}function showToolLimitPrompt(payload,msg,reply_channel){stop_monologue();toolLimitDecisionInFlight=false;if(toolLimitPromptEl&&toolLimitPromptEl.parentNode){toolLimitPromptEl.parentNode.removeChild(toolLimitPromptEl);}const consumed=typeof payload.consumed==='number'?payload.consumed:0;const limit=typeof payload.limit==='number'?payload.limit:10;const threshold=typeof payload.threshold==='number'?payload.threshold:limit;const remaining=typeof payload.remaining==='number'?payload.remaining:0;toolLimitPromptPayload={...payload,consumed,limit,threshold,remaining};toolLimitPromptEl=document.createElement('div');toolLimitPromptEl.className='chat-line tool tool-limit-prompt';toolLimitPromptEl.style.backdropFilter='blur(15px)';toolLimitPromptEl.style.background='transparent';toolLimitPromptEl.style.border='none';toolLimitPromptEl.style.borderRadius='12px';toolLimitPromptEl.style.padding='8px';toolLimitPromptEl.style.margin='4px 0';toolLimitPromptEl.style.color='white';const card=document.createElement('div');card.style.display='flex';card.style.flexDirection='column';card.style.gap='8px';const title=document.createElement('div');title.style.fontWeight='600';title.style.fontSize='15px';title.textContent='Continue with automated actions?';const subtitle=document.createElement('div');subtitle.style.fontSize='13px';subtitle.style.lineHeight='1.4';subtitle.textContent='Looks like you\'ve been going for a while now. Do you want to continue letting me take automated actions?';const buttons=document.createElement('div');buttons.style.display='flex';buttons.style.gap='8px';const continueBtn=document.createElement('button');continueBtn.className='tool-limit-btn continue';continueBtn.textContent='Yes, continue';continueBtn.style.padding='6px 12px';continueBtn.style.background='#E5E5E5';continueBtn.style.color='#000';continueBtn.style.border='none';continueBtn.style.borderRadius='6px';continueBtn.style.cursor='pointer';const stopBtn=document.createElement('button');stopBtn.className='tool-limit-btn stop';stopBtn.textContent='No, stop here';stopBtn.style.padding='6px 12px';stopBtn.style.background='transparent';stopBtn.style.border='1px solid #E5E5E5E5';stopBtn.style.color='#E5E5E5E5';stopBtn.style.borderRadius='6px';stopBtn.style.cursor='pointer';continueBtn.addEventListener('click',e=>{e.preventDefault();if(continueBtn.disabled)return;continueBtn.disabled=true;stopBtn.disabled=true;output=true;push_function_call_output(msg,output,reply_channel);removeToolLimitPrompt();});stopBtn.addEventListener('click',e=>{e.preventDefault();if(stopBtn.disabled)return;continueBtn.disabled=true;stopBtn.disabled=true;output=false;push_function_call_output(msg,output,reply_channel);removeToolLimitPrompt();});buttons.appendChild(continueBtn);buttons.appendChild(stopBtn);card.appendChild(title);card.appendChild(subtitle);card.appendChild(buttons);toolLimitPromptEl.appendChild(card);messagesEl.appendChild(toolLimitPromptEl);scrollToBottom(true);updateFollowerPosition();}function addMessage({role,text,pending,format}){hideLandingScreen();const sentimentButtons=messagesEl.querySelector('.sentiment-buttons');if(sentimentButtons){sentimentButtons.remove();}if(role!=='tool'){message_ref_list.push({role,text,pending,format});}else{message_ref_list.push({role,text,pending,format,result:'pending'});}const div=document.createElement('div');div.className='chat-line '+role;if(pending)div.classList.add('pending');div.style.background='transparent';div.style.border='none';div.style.padding='4px 0';div.style.margin='2px 0';div.style.color='white';if(role==='user'){div.innerHTML=`
                <div class="user-indicator">
                    <div class="user-label">You</div>
                    <div class="user-content">
                        ${format?marked.parse(text):text}
                    </div>
                </div>
            `;}else{if(format){div.innerHTML=marked.parse(text);}else{div.textContent=text;}}messagesEl.appendChild(div);scrollToBottom();updateFollowerPosition();if(role!=='tool'){_0x5c8548();}return div;}function autoResizeTextarea(el){if(!el)return;const cs=getComputedStyle(el);const lineHeight=parseFloat(cs.lineHeight)||18;const paddingTop=parseFloat(cs.paddingTop)||0;const paddingBottom=parseFloat(cs.paddingBottom)||0;const maxLines=5;const minHeight=41;const maxHeight=lineHeight*maxLines+paddingTop+paddingBottom;let baseOneLineHeight=lineHeight+paddingTop+paddingBottom;baseOneLineHeight=Math.max(baseOneLineHeight,minHeight);el.style.height='auto';let natural=el.scrollHeight;if(!el.value||el.value.indexOf('\n')===-1&&natural<=baseOneLineHeight+2){el.style.height=baseOneLineHeight+'px';el.style.overflowY='hidden';return;}const wanted=Math.min(natural,maxHeight);const wanted2=Math.max(wanted,minHeight);el.style.height=wanted2+'px';el.style.overflowY=natural>maxHeight?'auto':'hidden';}try{if(input){autoResizeTextarea(input);input.addEventListener('input',()=>autoResizeTextarea(input));input.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();const evt=new Event('submit',{bubbles:true,cancelable:true});form.dispatchEvent(evt);}});}}catch(e){console.error('autosize init failed',e);}function renderToolCallFromHistory(msg){try{try{message_ref_list.push({role:'tool',text:msg.primary_text,pending:false,format:false,args:msg.tool_call_args,output:msg.tool_call_output});}catch(_){}const toolName=msg.primary_text;if(toolName&&CUSTOM_REBUILDERS&&typeof CUSTOM_REBUILDERS[toolName]==='function'){CUSTOM_REBUILDERS[toolName](msg);return;}start_tool_message(msg.primary_text);if(msg.tool_call_output){resolve_tool_message(msg.tool_call_output);}}catch(e){console.error('renderToolCallFromHistory failed:',e);}}function wait_for_user_input(instant_show=false){stop_monologue();const existingSentimentButtons=messagesEl.querySelector('.sentiment-buttons');if(existingSentimentButtons){existingSentimentButtons.remove();}const container=document.createElement('div');container.className='chat-line tool sentiment-buttons';container.style.backdropFilter='blur(15px)';container.style.background='transparent';container.style.border='none';container.style.borderRadius='12px';container.style.padding='4px 0';container.style.margin='4px 0';container.style.color='white';container.style.display='flex';container.style.justifyContent='flex-start';container.style.gap='8px';const positiveBtn=document.createElement('button');positiveBtn.className='sentiment-btn positive-btn positive';positiveBtn.innerHTML=_0x464300;positiveBtn.style.background='transparent';positiveBtn.style.border='none';positiveBtn.style.cursor='pointer';positiveBtn.style.padding='4px';positiveBtn.style.borderRadius='4px';positiveBtn.title='Positive';const negativeBtn=document.createElement('button');negativeBtn.className='sentiment-btn negative-btn negative';negativeBtn.innerHTML=_0x17d951;negativeBtn.style.background='transparent';negativeBtn.style.border='none';negativeBtn.style.cursor='pointer';negativeBtn.style.padding='4px';negativeBtn.style.borderRadius='4px';negativeBtn.title='Negative';if(instant_show){positiveBtn.style.opacity='1';positiveBtn.style.animation='none';negativeBtn.style.opacity='1';negativeBtn.style.animation='none';}const updateSentiment=sentiment=>{if(sentiment==='positive'){positiveBtn.innerHTML=_0x592c22;negativeBtn.innerHTML=_0x17d951;}else{negativeBtn.innerHTML=_0x4cb03e;positiveBtn.innerHTML=_0x464300;}currentSentiment=sentiment;const token=conversationInfo?.token;if(!token){console.error('No token available for sentiment update');return;}const payload={token:token,sentiment:sentiment};if(_0x449a5d){payload.dev_token=_0x449a5d;}fetch(`${_0x5e3503}${_0x56e6e2}/api/chat/update_sentiment`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).then(r=>{if(!r.ok)throw new Error('Failed to update sentiment');console.log('Sentiment updated successfully');}).catch(err=>{console.error('Failed to update sentiment:',err);});};positiveBtn.addEventListener('click',()=>updateSentiment('positive'));negativeBtn.addEventListener('click',()=>updateSentiment('negative'));container.appendChild(positiveBtn);container.appendChild(negativeBtn);messagesEl.appendChild(container);scrollToBottom(true);return;}function start_tool_message(tool_name){tool_call_pending=true;try{if(CUSTOM_REBUILDERS&&typeof CUSTOM_REBUILDERS[tool_name]==='function'){return;}}catch(_){}const container=document.createElement('div');container.className='chat-line tool tool-box';container.dataset.toolName=tool_name||'';container.style.backdropFilter='blur(15px)';container.style.background='transparent';container.style.border='none';container.style.borderRadius='12px';container.style.padding='8px';container.style.margin='4px 0';container.style.color='white';function escapeHtml(str){if(str===null||str===undefined)return'';return String(str).replace(/[&<>\"]/g,function(s){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s];});}const argsText='';const displayName=_0x249085[tool_name]||'Working...';container.innerHTML=`
                    <div class='card flex-row gap-2'>
                        <div class="status-icons">
                            <!-- Processing spinner SVG (fixed 24x24) -->
                            <svg class="status-processing" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="none" aria-hidden="true">
                                <circle class="spinner-circle" cx="12" cy="12" r="9" stroke="#e5e5e5e5" stroke-width="2.5" stroke-linecap="round" stroke-dasharray="40" stroke-dashoffset="10"></circle>
                            </svg>
                            <!-- Success: use provided good check SVG -->
                            <svg class="status-success hidden" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#009600" aria-hidden="true"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>
                            <!-- Error: use provided bad x SVG -->
                            <svg class="status-error hidden" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="red" aria-hidden="true"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
                        </div>
                        <div class='tool-text'>
                            <p class='tool-title'>${escapeHtml(displayName)}</p>
                            <p class='arg-msg'>${escapeHtml(argsText)}</p>
                        </div>
                    </div>
            `;messagesEl.appendChild(container);scrollToBottom();updateFollowerPosition();}function resolve_tool_message(tool_call_output){const lastToolMessage=messagesEl.querySelector('.tool-box:last-child');if(!lastToolMessage)return;const processing=lastToolMessage.querySelector('.status-processing');const success=lastToolMessage.querySelector('.status-success');const error=lastToolMessage.querySelector('.status-error');processing.classList.add('hidden');const isRedirect=lastToolMessage.dataset.toolName==='redirect';if(isRedirect&&tool_call_output&&tool_call_output.toLowerCase().includes('declined')){error.classList.remove('hidden');success.classList.add('hidden');}else{success.classList.remove('hidden');error.classList.add('hidden');}for(let i=message_ref_list.length-1;i>=0;i--){if(message_ref_list[i].role==='tool'){message_ref_list[i].output=tool_call_output;break;}}tool_call_pending=false;if(isRedirect){const buttons=lastToolMessage.querySelectorAll('.redirect-continue, .redirect-pause');buttons.forEach(btn=>btn.remove());}updateFollowerPosition();}function handleIncomingMessage(m){const type=m.type;if(type==='ai'){if(!m.primary_text||String(m.primary_text).trim()==='')return;addMessage({role:'ai',text:m.primary_text,format:true});}else if(type==='user'){addMessage({role:'user',text:m.primary_text});}else if(type==='tool'){renderToolCallFromHistory(m);}else if(type==='system'){}else{throw new Error('Unknown message type: '+type);}}function rebuild_conversation(new_convo_data_messages,conversation){try{stop_monologue();clearMessages();messagesEl.innerHTML='';_0x88383f=null;aiPendingEl=null;try{bubblesContainer.innerHTML='';}catch(_){}if(Array.isArray(new_convo_data_messages)){new_convo_data_messages.forEach(m=>handleIncomingMessage(m));}else{throw new Error('Invalid messages data for rebuild_conversation');}updateFollowerPosition();scrollToBottom();update_convo(conversation);disconnectWS();wait_for_user_input(true);}catch(e){console.error('Failed to rebuild conversation:',e);}}function refresh_conversation_ui(new_convo_data_messages,conversation){try{stop_monologue();clearMessages();messagesEl.innerHTML='';_0x88383f=null;aiPendingEl=null;try{bubblesContainer.innerHTML='';}catch(_){}if(Array.isArray(new_convo_data_messages)){new_convo_data_messages.forEach(m=>handleIncomingMessage(m));}else{throw new Error('Invalid messages data for refresh_conversation_ui');}updateFollowerPosition();scrollToBottom();update_convo(conversation);console.log('[Interrupt] UI refreshed, waiting for stream to start');}catch(e){console.error('Failed to refresh conversation UI:',e);}}function push_function_call_output(msg,output,reply_channel,conversation_id_override){const conversation_id=conversation_id_override||conversationInfo?.id||conversationInfo?.conversation_id;if(!conversation_id){console.error('No conversation id available to push function call output to.');return;}try{console.log('sending PUSH_TOOL_OUTPUT:',{conversation_id,reply_channel,output});ws.send(JSON.stringify({event_type:'PUSH_TOOL_OUTPUT',conversation_id:conversation_id,reply_channel:reply_channel,data:output}));}catch(e){addErrorMessage('Error','Failed to send function call output to server.');console.error('Failed to send PUSH_TOOL_OUTPUT:',e);}}function showThinkingIndicator(){if(followerCircleEl){followerCircleEl.style.display='block';followerCircleEl.style.animationPlayState='running';}}function hideThinkingIndicator(){if(followerCircleEl){followerCircleEl.style.display='none';followerCircleEl.style.animationPlayState='paused';}}let monologue_ongoing=false;function start_monologue(){monologue_ongoing=true;showThinkingIndicator();try{updateSendButtonState();}catch(e){}}function stop_monologue(){monologue_ongoing=false;hideThinkingIndicator();try{updateSendButtonState();}catch(e){}}function is_monologue_ongoing(){return monologue_ongoing;}let tool_call_count=0;let ws=null;let aiPendingEl=null;function disconnectWS(){try{ws.close();}catch(e){}ws=null;}function connectWs(conversationInfo){const token=conversationInfo.token;const websiteName=conversationInfo.website_name;const clientuser_tag=conversationInfo.clientuser_tag;let WS_URL=`${_0x25914f}${_0x56e6e2}/ws/chat/`;WS_URL+=`?token=${encodeURIComponent(token)}`;WS_URL+=`&website_name=${encodeURIComponent(websiteName)}`;WS_URL+=`&clientuser_tag=${encodeURIComponent(clientuser_tag)}`;if(_0x449a5d){WS_URL+=`&dev_token=${encodeURIComponent(_0x449a5d)}`;WS_URL+=`&website_codename=${encodeURIComponent(_0x1e9c03)}`;}ws=new WebSocket(WS_URL);ws.addEventListener('open',()=>{console.log('Chat WS connected');});let ai_text_content='';ws.addEventListener('message',ev=>{try{const msg=JSON.parse(ev.data);const event=msg.event_type;const data=msg.data;const reply_channel=data?.reply_channel??null;const getChunkText=d=>{if(!d&&d!==0)return'';if(typeof d==='string')return d;if(typeof d==='object'){if(typeof d.chunk==='string')return d.chunk;if(d.chunk&&typeof d.chunk.content==='string')return d.chunk.content;if(typeof d.content==='string')return d.content;if(typeof d.text==='string')return d.text;if(d.data&&typeof d.data==='string')return d.data;}try{return JSON.stringify(d);}catch(e){return String(d);}};switch(event){case'conversation_accepted':console.log('Conversation accepted:',msg.conversation);update_convo(msg.conversation);break;case'<TOOL CALL>':console.log('Function called:',msg.data.name);console.log('args:',msg.data.args);console.log('msg:',msg);start_tool_message(msg.data.name);try{tool_call_count+=1;}catch(e){}break;case'<CONTINUE?>':showToolLimitPrompt(data,msg,reply_channel);break;case'<TOOL CALL FRONTEND>':console.log('Function called (frontend):',msg.data.name);console.log('args:',msg.data.args);msg.data.reply_channel=reply_channel;let args=msg.data.args;args['reply_channel']=reply_channel;if(!reply_channel){throw new Error('No reply_channel provided for frontend function call');}try{tool_call_count+=1;let func=null;console.log('Looking up frontend function: "',msg.data.name,'"');if(msg.data.name in BUILT_IN_FUNCTIONS){func=BUILT_IN_FUNCTIONS[msg.data.name];}else if(msg.data.name in LUZARN_BOT_DEFINITIONS.TOOLS){func=LUZARN_BOT_DEFINITIONS.TOOLS[msg.data.name];}else{console.error('Undefined frontend function:',msg.data.name,', Perhaps it was not registered in LUZARN_BOT_DEFINITIONS.TOOLS?');throw new Error('Unknown frontend function: '+msg.data.name);}const output=func(args);console.log('Function output:',output);console.log('Type of output:',typeof output);if(typeof output==='string'){try{push_function_call_output(msg,output,reply_channel);}catch(e){try{tool_call_count=Math.max(0,tool_call_count-1);}catch(e){}}}else{logger.error('Frontend tool returned non-string output!');addErrorMessage('Tool Error','A tool has failed. Please contact website staff.');try{push_function_call_output(msg,'Tool returned invalid output type.',reply_channel);}catch(e){}}}catch(err){try{tool_call_count=Math.max(0,tool_call_count-1);}catch(e){}try{push_function_call_output(msg,'Tool execution error: '+String(err),reply_channel);}catch(e){}}break;case'response':addMessage({role:'ai',text:getChunkText(data)});break;case'tool_limit_decision_ack':toolLimitDecisionInFlight=false;removeToolLimitPrompt();if(data&&data.decision==='continue'){start_monologue();}else{stop_monologue();}break;case'<MODEL START>':console.log('[Stream] Model start');break;case'<CHAIN START>':console.log('[Stream] Chain start, resetting ai_text_content and creating aiPendingEl');ai_text_content='';if(!aiPendingEl){aiPendingEl=addMessage({role:'ai',text:'',pending:true});console.log('[Stream] Created new aiPendingEl:',aiPendingEl);}else{console.log('[Stream] aiPendingEl already exists, reusing');}start_monologue();updateFollowerPosition();scrollToBottom();break;case'<CHUNK>':{const chunkText=getChunkText(data);console.log('[Stream] Chunk received, length:',chunkText.length,'aiPendingEl:',!!aiPendingEl);if(!aiPendingEl){ai_text_content=chunkText;aiPendingEl=addMessage({role:'ai',text:chunkText,pending:true});console.log('[Stream] Created aiPendingEl from chunk');}else{ai_text_content+=chunkText;aiPendingEl.innerHTML=marked.parse(ai_text_content);console.log('[Stream] Updated aiPendingEl, total length:',ai_text_content.length);}scrollToBottom();updateFollowerPosition();break;}case'<MODEL END>':{if(aiPendingEl){try{aiPendingEl.classList.remove('pending');}catch(_){}aiPendingEl=null;}const historyPayload=data&&typeof data==='object'?data:{};const historyConversation=historyPayload.conversation&&typeof historyPayload.conversation==='object'?historyPayload.conversation:null;if(historyConversation){update_convo(historyConversation);}const checkpointFromServer=historyPayload.checkpointed_at||historyConversation&&historyConversation.checkpointed_at||null;if(checkpointFromServer){lastSeenCheckpoint=String(checkpointFromServer);}const historyMessages=Array.isArray(historyPayload.messages)?historyPayload.messages:null;const conversationIdForHistory=getConversationId(historyConversation)||getConversationId(conversationInfo);if(historyMessages&&conversationIdForHistory){const cookiePayload={conversation_id:conversationIdForHistory,conversation:historyConversation,messages:historyMessages,checkpointed_at:checkpointFromServer?String(checkpointFromServer):null};try{_0x4589ab(CONVERSATION_HISTORY_COOKIE_KEY);}catch(_){}try{_0x1ee3d1(CONVERSATION_HISTORY_COOKIE_KEY,cookiePayload,30);}catch(err){console.warn('[focus-sync] failed to persist conversation history cookie',err);}}wait_for_user_input();skip_close_msg=true;disconnectWS();setTimeout(wait_for_user_input,300);break;}case'<CHAIN END>':if(aiPendingEl){aiPendingEl.classList.remove('pending');aiPendingEl=null;}updateFollowerPosition();break;case'<TOOL OUTPUT>':try{resolve_tool_message(data.tool_call_output);try{tool_call_count=Math.max(0,tool_call_count-1);}catch(e){}}catch(e){console.error('update tool output',e);addMessage({role:'ai',text:'Sorry \u2014 there was an error processing a tool response. Please try again or refresh the page.'});}break;case'<TOKEN LIMIT>':addErrorMessage('You have exceeded your token limit.','Sorry, please try again later.');break;case'<ERROR>':addErrorMessage('An error has occured.','Please try again later.');break;case'<DEV ERROR>':addErrorMessage('A configuration error has occured.','Please contact website support.');console.error('Server reported configuration error:\n',data);stop_monologue();break;case'interrupt_response':console.log('Interrupt response:',data);refresh_conversation_ui(data.new_convo_data_messages,data.conversation);break;case'send_message_response':console.log('Send message response:',data);if(data.conversation){update_convo(data.conversation);}break;default:addErrorMessage('An error has occured.','Unknown chat event.');console.warn('Unknown chat event type',event);console.warn('full msg:',msg);}}catch(e){console.error('ws message parse',e);}});ws.addEventListener('close',()=>{console.info('Chat WS disconnected');if(!skip_close_msg){addErrorMessage('Connection lost','Please refresh the page to reconnect.');}ws=null;});ws.addEventListener('error',e=>{console.error('Chat WS error',e);const pending=messagesEl.querySelector('.chat-line.user.pending:last-of-type');if(pending)pending.classList.remove('pending');});}function sendWhenWsConnected(text,opts){console.log('2.2 - WebSocket connection established');const requestBody={event_type:'send_message',text:text,current_page:_0x4d6f4c(),conversation:conversationInfo};if(opts&&opts.interrupted===true){requestBody.interrupted=true;}ws.send(JSON.stringify(requestBody));if(!(opts&&opts.interrupted)){console.log('Starting new chain');start_monologue();}else{console.log('Interrupted send acknowledged (no chain start)');}};form.addEventListener('submit',async e=>{e.preventDefault();const interruptedFlag=form.dataset.interrupted==='true';let text=input.value.trim();if(interruptedFlag){text='';delete form.dataset.interrupted;}else{if(!text)return;}const sentimentButtons=messagesEl.querySelector('.sentiment-buttons');if(sentimentButtons){sentimentButtons.remove();}bubblesContainer.innerHTML='';console.log('monologue_ongoing:',is_monologue_ongoing(),'tool_call_pending():',tool_call_pending);if(is_monologue_ongoing()){console.log('Interrupting current generation');if(interruptedFlag){delete form.dataset.interrupted;try{stop_monologue();}catch(_){}}addMessage({role:'user',text,pending:true});input.value='';try{autoResizeTextarea(input);}catch(_){}if(ws&&ws.readyState===WebSocket.OPEN){const requestBody={event_type:'interrupt',text:text,current_page:_0x4d6f4c(),conversation:conversationInfo};ws.send(JSON.stringify(requestBody));console.log('Interrupt event sent with text:',text?text.substring(0,50):'(empty)');}else{console.error('WebSocket not available for interrupt');addErrorMessage('Connection issue','Please try again.');}}else{addMessage({role:'user',text,pending:true});input.value='';try{autoResizeTextarea(input);}catch(_){}if(!ws||ws.readyState!==WebSocket.OPEN){console.log('1 - Establishing new WebSocket connection with');console.log('1.1 - Connecting to token:',conversationInfo.token);console.log('1.2 - Connecting to website_name:',conversationInfo.website_name);connectWs(conversationInfo);waitForConversationAccepted=new Promise(resolve=>{const checkInterval=setInterval(()=>{if(convo_updated){console.log('2.1 - convo_updated registered');convo_updated=false;clearInterval(checkInterval);sendWhenWsConnected(text,{interrupted:interruptedFlag});}},100);});}else{console.log('2.1 - Re-using connection');sendWhenWsConnected(text,{interrupted:interruptedFlag});}}});console.log('Chat widget initialized.');try{const onMessagesScroll=()=>{updateFollowerPosition();autoStickToBottom=isNearBottom();};chatMessagesEl.addEventListener('scroll',onMessagesScroll,{passive:true});window.addEventListener('resize',updateFollowerPosition);const obs=new MutationObserver(()=>{updateFollowerPosition();scrollToBottom(false);});obs.observe(messagesEl,{childList:true,subtree:true,characterData:true});}catch(_){}const redirectQuest=_0x2eaf5c();if(redirectQuest){console.log('Catching redirect quest url:',redirectQuest.url,'reply_channel:',redirectQuest.reply_channel);connectWs(conversationInfo);ws.addEventListener('open',()=>{let msg=null;const current_url=_0x3c40c5(window.location.href);if(redirectQuest.url===current_url){msg='Successfully redirected to '+redirectQuest.url;}else{msg='Attempted redirect to '+redirectQuest.url+', got redirected to '+current_url;}_0xf95740(500);push_function_call_output(null,msg,redirectQuest.reply_channel,conversationInfo.id);});}try{updateSendButtonState();}catch(e){}}()));function a0_0x5e63(_0x4f6044,_0x15148f){const _0xa088b5=a0_0xa088();return a0_0x5e63=function(_0x5e632b,_0x30d286){_0x5e632b=_0x5e632b-0x148;let _0x58ce08=_0xa088b5[_0x5e632b];return _0x58ce08;},a0_0x5e63(_0x4f6044,_0x15148f);}function a0_0xa088(){const _0x598e87=[':host\x20{\x20all:\x20initial;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*,\x20*::before,\x20*::after\x20{\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chatbot-wrapper\x20{\x20position:\x20relative;\x20font-family:\x20inherit;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button,\x20textarea\x20{\x20font-family:\x20inherit;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chatbot-launcher\x20{\x20position:\x20fixed;\x20bottom:\x200;\x20right:\x200;\x20}','none','aria-label','368880btSuaV','removeEventListener','link[data-luzarn-widget-style]','border','product_url','link','white','toUpperCase','56536zZCJMB','createElement','log','backgroundColor','product-read-more-btn','product-actions','redirect_quest','background','Searching\x20my\x20data...','#E5E5E5','className','&amp;','attachShadow','127.0.0.1:8000','591867kWOWOi','1mfNKER','LUZARN_BOT_DEFINITIONS.OVERRIDES.','startsWith','product-list','Reading...','location','product-image-large','open','description','endsWith','393886vLQklj','src','pathname','price','object','product-price','href','protocols:','div','SameSite=Lax','setAttribute','products','padding:4px\x208px;\x20background-color:\x20#E5E5E5;\x20color:black;\x20border:none;\x20border-radius:4px;\x20cursor:pointer;\x20text-decoration:none;\x20transition:background-color\x200.2s\x20ease;','bottom','\x20mode,\x20server:\x20','join','right','No\x20products\x20to\x20show.','LUZARN_BOT_DEFINITIONS\x20or\x20OVERRIDES\x20not\x20found;\x20using\x20defaults.','https://','0.0.0.0','toLowerCase','wss://','4px\x208px','luzarn.com','Redirecting...','Max-Age=0','add','16px','classList','name','ws://','image_url','\x20products.\x20Do\x20not\x20list\x20products\x20directly\x20in\x20your\x20next\x20message.\x20Ask\x20the\x20user\x20if\x20they\x20would\x20like\x20to\x20refine\x20their\x20search\x20instead.','&lt;','indexOf','chat-line\x20ai','cssText','transparent','::1','consented_optional','WEBSITE_CODENAME\x20is\x20required.\x20Please\x20set\x20it\x20in\x20LUZARN_BOT_DEFINITIONS.','luzarn-chatbot-host','resize','product-title','user_tag','Domain=.','zIndex','borderRadius','95293tNFzNy','split','Read\x20more','true','remove','-apple-system,\x20BlinkMacSystemFont,\x20\x27Segoe\x20UI\x27,\x20Roboto,\x20Oxygen,\x20Ubuntu,\x20Cantarell,\x20\x27Fira\x20Sans\x27,\x20\x27Droid\x20Sans\x27,\x20\x27Helvetica\x20Neue\x27,\x20Arial,\x20sans-serif','addEventListener','rel','Path=/','highlightPulse\x202s\x20ease-in-out','57228WyFwWn','LINK','position','style','Highlight\x20failed:\x20no\x20element\x20provided','test','https://cdn.jsdelivr.net/gh/MarvellousBee/luzarn_public_webot_builds@latest/latest.css','appendChild','isArray','14xBTRun','product-card','slice','fontFamily','tagName','smooth','getElementById','push','onerror','replace','2147483647','Successfully\x20displayed\x20','2px\x200','Image\x20of\x20','error','padding','Chatbot\x20running\x20in\x20','img','3px\x20solid\x20red','DEVMODE_TOKEN','initial','length','data-luzarn-widget-style','470GWlOPA','message','false','shadowRoot','product-title-price','data-expanded','head','all','observe','parse','aria-expanded','http://127.0.0.1:8000/serve/latest.css','left','product-header','Untitled','margin','Highlight\x20successfully\x20scheduled,\x20will\x20be\x20displayed\x20alongside\x20the\x20next\x20message.','product-body','list','&quot;','querySelector','height','color','scroll','WEBSITE_CODENAME','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20height=\x2218px\x22\x20viewBox=\x220\x20-960\x20960\x20960\x22\x20width=\x2218px\x22\x20fill=\x22#e5e5e5e6\x22><path\x20d=\x22M240-840h440v520L400-40l-50-50q-7-7-11.5-19t-4.5-23v-14l44-174H120q-32\x200-56-24t-24-56v-80q0-7\x202-15t4-15l120-282q9-20\x2030-34t44-14Zm360\x2080H240L120-480v80h360l-54\x20220\x20174-174v-406Zm0\x20406v-406\x20406Zm80\x2034v-80h120v-360H680v-80h200v520H680Z\x22/></svg>','Product\x20image','alt','lazy','hostname','warn','localhost','highlight-pulse-style','product-thumb','title','button','Override\x20applied\x20for:\x20','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20height=\x2218px\x22\x20viewBox=\x220\x20-960\x20960\x20960\x22\x20width=\x2218px\x22\x20fill=\x22#e5e5e5e6\x22><path\x20d=\x22M720-120H320v-520l280-280\x2050\x2050q7\x207\x2011.5\x2019t4.5\x2023v14l-44\x20174h218q32\x200\x2056\x2024t24\x2056v80q0\x207-1.5\x2015t-4.5\x2015L794-168q-9\x2020-30\x2034t-44\x2014ZM240-640v520H80v-520h160Z\x22/></svg>','Browsing\x20the\x20web...','found','mouseenter','3026790CsuHeV','innerHTML','textContent','body','prototype','cloneNode','chatbot-highlight-overlay','click','stylesheet','<br/>','scrollX','type','querySelectorAll','development','__luzarn_deferred_style_injection','OVERRIDES','getAttribute','product-description','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20height=\x2218px\x22\x20viewBox=\x220\x20-960\x20960\x20960\x22\x20width=\x2218px\x22\x20fill=\x22#e5e5e5e6\x22><path\x20d=\x22M240-840h400v520L360-40l-50-50q-7-7-11.5-19t-4.5-23v-14l44-174H120q-32\x200-56-24t-24-56v-80q0-7\x201.5-15t4.5-15l120-282q9-20\x2030-34t44-14Zm480\x20520v-520h160v520H720Z\x22/></svg>','loading','top','Highlight\x20failed:\x20','placeholder','addedNodes','product-empty','width','cookie','center','disconnect','25PAoZEw','mouseleave'];a0_0xa088=function(){return _0x598e87;};return a0_0xa088();}